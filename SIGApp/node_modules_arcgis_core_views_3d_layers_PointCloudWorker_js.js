"use strict";
(self["webpackChunkrealgis"] = self["webpackChunkrealgis"] || []).push([["node_modules_arcgis_core_views_3d_layers_PointCloudWorker_js"],{

/***/ 49533:
/*!*****************************************************!*\
  !*** ./node_modules/@arcgis/core/chunks/vec3f32.js ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "O": () => (/* binding */ f),
/* harmony export */   "U": () => (/* binding */ l),
/* harmony export */   "Z": () => (/* binding */ i),
/* harmony export */   "a": () => (/* binding */ t),
/* harmony export */   "b": () => (/* binding */ e),
/* harmony export */   "c": () => (/* binding */ n),
/* harmony export */   "d": () => (/* binding */ s),
/* harmony export */   "e": () => (/* binding */ c),
/* harmony export */   "f": () => (/* binding */ r),
/* harmony export */   "g": () => (/* binding */ _),
/* harmony export */   "h": () => (/* binding */ y),
/* harmony export */   "o": () => (/* binding */ o),
/* harmony export */   "u": () => (/* binding */ u),
/* harmony export */   "v": () => (/* binding */ w),
/* harmony export */   "z": () => (/* binding */ a)
/* harmony export */ });
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
function n() {
  return new Float32Array(3);
}
function t(n) {
  const t = new Float32Array(3);
  return t[0] = n[0], t[1] = n[1], t[2] = n[2], t;
}
function r(n, t, r) {
  const e = new Float32Array(3);
  return e[0] = n, e[1] = t, e[2] = r, e;
}
function e(n, t) {
  return new Float32Array(n, t, 3);
}
function a() {
  return n();
}
function o() {
  return r(1, 1, 1);
}
function u() {
  return r(1, 0, 0);
}
function s() {
  return r(0, 1, 0);
}
function c() {
  return r(0, 0, 1);
}
const i = a(),
  f = o(),
  l = u(),
  _ = s(),
  y = c(),
  w = Object.freeze(Object.defineProperty({
    __proto__: null,
    ONES: f,
    UNIT_X: l,
    UNIT_Y: _,
    UNIT_Z: y,
    ZEROS: i,
    clone: t,
    create: n,
    createView: e,
    fromValues: r,
    ones: o,
    unitX: u,
    unitY: s,
    unitZ: c,
    zeros: a
  }, Symbol.toStringTag, {
    value: "Module"
  }));


/***/ }),

/***/ 78444:
/*!***********************************************************************!*\
  !*** ./node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js ***!
  \***********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ h)
/* harmony export */ });
/* harmony import */ var _core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../core/arrayUtils.js */ 19420);
/* harmony import */ var _core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../core/typedArrayUtil.js */ 13878);
/* harmony import */ var _chunks_quat_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../chunks/quat.js */ 50894);
/* harmony import */ var _chunks_quatf64_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../chunks/quatf64.js */ 29042);
/* harmony import */ var _chunks_vec3_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../chunks/vec3.js */ 92950);
/* harmony import */ var _chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../chunks/vec3f32.js */ 49533);
/* harmony import */ var _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../geometry/SpatialReference.js */ 68230);
/* harmony import */ var _geometry_projection_projectBuffer_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../geometry/projection/projectBuffer.js */ 99128);
/* harmony import */ var _i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./i3s/PointCloudWorkerUtil.js */ 66404);
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/









class p {
  transform(t) {
    const e = this._transform(t),
      a = [e.points.buffer, e.rgb.buffer];
    null != e.pointIdFilterMap && a.push(e.pointIdFilterMap.buffer);
    for (const o of e.attributes) "buffer" in o.values && (0,_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_1__.isArrayBuffer)(o.values.buffer) && o.values.buffer !== e.rgb.buffer && a.push(o.values.buffer);
    return Promise.resolve({
      result: e,
      transferList: a
    });
  }
  _transform(r) {
    const e = (0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.readGeometry)(r.schema, r.geometryBuffer);
    let a = e.length / 3,
      o = null;
    const n = new Array(),
      f = (0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.getAttributeValues)(r.primaryAttributeData, e, a);
    null != r.primaryAttributeData && f && n.push({
      attributeInfo: r.primaryAttributeData.attributeInfo,
      values: f
    });
    const s = (0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.getAttributeValues)(r.modulationAttributeData, e, a);
    null != r.modulationAttributeData && s && n.push({
      attributeInfo: r.modulationAttributeData.attributeInfo,
      values: s
    });
    let p = (0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.evaluateRenderer)(r.rendererInfo, f, s, a);
    if (r.filterInfo && r.filterInfo.length > 0 && null != r.filterAttributesData) {
      const f = r.filterAttributesData.filter(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_0__.isSome).map(t => {
        const r = (0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.getAttributeValues)(t, e, a),
          o = {
            attributeInfo: t.attributeInfo,
            values: r
          };
        return n.push(o), o;
      });
      o = new Uint32Array(a), a = (0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.filterInPlace)(e, p, o, r.filterInfo, f);
    }
    for (const t of r.userAttributesData) {
      const r = (0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.getAttributeValues)(t, e, a);
      n.push({
        attributeInfo: t.attributeInfo,
        values: r
      });
    }
    3 * a < p.length && (p = new Uint8Array(p.buffer.slice(0, 3 * a))), this._applyElevationOffsetInPlace(e, a, r.elevationOffset);
    const c = this._transformCoordinates(e, a, r.obb, _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_6__["default"].fromJSON(r.inSR), _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_6__["default"].fromJSON(r.outSR));
    return {
      obb: r.obb,
      points: c,
      rgb: p,
      attributes: n,
      pointIdFilterMap: o
    };
  }
  _transformCoordinates(t, r, a, i, u) {
    if (!(0,_geometry_projection_projectBuffer_js__WEBPACK_IMPORTED_MODULE_7__.projectBuffer)(t, i, 0, t, u, 0, r)) throw new Error("Can't reproject");
    const l = (0,_chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__.f)(a.center[0], a.center[1], a.center[2]),
      b = (0,_chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__.c)(),
      m = (0,_chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__.c)();
    (0,_chunks_quat_js__WEBPACK_IMPORTED_MODULE_2__.a)(c, a.quaternion);
    const p = new Float32Array(3 * r);
    for (let e = 0; e < r; e++) b[0] = t[3 * e] - l[0], b[1] = t[3 * e + 1] - l[1], b[2] = t[3 * e + 2] - l[2], (0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_4__.v)(m, b, c), a.halfSize[0] = Math.max(a.halfSize[0], Math.abs(m[0])), a.halfSize[1] = Math.max(a.halfSize[1], Math.abs(m[1])), a.halfSize[2] = Math.max(a.halfSize[2], Math.abs(m[2])), p[3 * e] = b[0], p[3 * e + 1] = b[1], p[3 * e + 2] = b[2];
    return p;
  }
  _applyElevationOffsetInPlace(t, r, e) {
    if (0 !== e) for (let a = 0; a < r; a++) t[3 * a + 2] += e;
  }
}
const c = (0,_chunks_quatf64_js__WEBPACK_IMPORTED_MODULE_3__.a)();
function h() {
  return new p();
}


/***/ }),

/***/ 66404:
/*!*******************************************************************************!*\
  !*** ./node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js ***!
  \*******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "elevationFromPositions": () => (/* binding */ a),
/* harmony export */   "evaluateRenderer": () => (/* binding */ i),
/* harmony export */   "filterInPlace": () => (/* binding */ f),
/* harmony export */   "getAttributeValues": () => (/* binding */ c),
/* harmony export */   "readGeometry": () => (/* binding */ u)
/* harmony export */ });
/* harmony import */ var _core_has_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../core/has.js */ 67087);
/* harmony import */ var _renderers_PointCloudClassBreaksRenderer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../renderers/PointCloudClassBreaksRenderer.js */ 97170);
/* harmony import */ var _renderers_PointCloudStretchRenderer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../renderers/PointCloudStretchRenderer.js */ 4085);
/* harmony import */ var _renderers_PointCloudUniqueValueRenderer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../renderers/PointCloudUniqueValueRenderer.js */ 12234);
/* harmony import */ var _I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./I3SBinaryReader.js */ 14726);
/* harmony import */ var _LEPCC_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./LEPCC.js */ 9572);
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/






function i(t, n, l, s) {
  const {
    rendererJSON: i,
    isRGBRenderer: u
  } = t;
  let c = null,
    a = null;
  if (n && u) c = n;else if (n && "pointCloudUniqueValueRenderer" === i?.type) {
    a = _renderers_PointCloudUniqueValueRenderer_js__WEBPACK_IMPORTED_MODULE_3__["default"].fromJSON(i);
    const e = a.colorUniqueValueInfos;
    c = new Uint8Array(3 * s);
    const r = d(a.fieldTransformType);
    for (let o = 0; o < s; o++) {
      const t = (r ? r(n[o]) : n[o]) + "";
      for (let r = 0; r < e.length; r++) if (e[r].values.includes(t)) {
        c[3 * o] = e[r].color.r, c[3 * o + 1] = e[r].color.g, c[3 * o + 2] = e[r].color.b;
        break;
      }
    }
  } else if (n && "pointCloudStretchRenderer" === i?.type) {
    a = _renderers_PointCloudStretchRenderer_js__WEBPACK_IMPORTED_MODULE_2__["default"].fromJSON(i);
    const e = a.stops;
    c = new Uint8Array(3 * s);
    const o = d(a.fieldTransformType);
    for (let r = 0; r < s; r++) {
      const t = o ? o(n[r]) : n[r],
        l = e.length - 1;
      if (t < e[0].value) c[3 * r] = e[0].color.r, c[3 * r + 1] = e[0].color.g, c[3 * r + 2] = e[0].color.b;else if (t >= e[l].value) c[3 * r] = e[l].color.r, c[3 * r + 1] = e[l].color.g, c[3 * r + 2] = e[l].color.b;else for (let o = 1; o < e.length; o++) if (t < e[o].value) {
        const n = (t - e[o - 1].value) / (e[o].value - e[o - 1].value);
        c[3 * r] = e[o].color.r * n + e[o - 1].color.r * (1 - n), c[3 * r + 1] = e[o].color.g * n + e[o - 1].color.g * (1 - n), c[3 * r + 2] = e[o].color.b * n + e[o - 1].color.b * (1 - n);
        break;
      }
    }
  } else if (n && "pointCloudClassBreaksRenderer" === i?.type) {
    a = _renderers_PointCloudClassBreaksRenderer_js__WEBPACK_IMPORTED_MODULE_1__["default"].fromJSON(i);
    const r = a.colorClassBreakInfos;
    c = new Uint8Array(3 * s);
    const o = d(a.fieldTransformType);
    for (let e = 0; e < s; e++) {
      const t = o ? o(n[e]) : n[e];
      for (let o = 0; o < r.length; o++) if (t >= r[o].minValue && t <= r[o].maxValue) {
        c[3 * e] = r[o].color.r, c[3 * e + 1] = r[o].color.g, c[3 * e + 2] = r[o].color.b;
        break;
      }
    }
  } else c = new Uint8Array(3 * s).fill(255);
  if (l && a?.colorModulation) {
    const e = a.colorModulation.minValue,
      r = a.colorModulation.maxValue,
      o = .3;
    for (let t = 0; t < s; t++) {
      const n = l[t],
        s = n >= r ? 1 : n <= e ? o : o + (1 - o) * (n - e) / (r - e);
      c[3 * t] = s * c[3 * t], c[3 * t + 1] = s * c[3 * t + 1], c[3 * t + 2] = s * c[3 * t + 2];
    }
  }
  return c;
}
function u(e, r) {
  if (null == e.encoding || "" === e.encoding) {
    const o = (0,_I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_4__.createGeometryIndexFromSchema)(r, e);
    if (null == o.vertexAttributes.position) return;
    const l = (0,_I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_4__.createTypedView)(r, o.vertexAttributes.position),
      s = o.header.fields,
      i = [s.offsetX, s.offsetY, s.offsetZ],
      u = [s.scaleX, s.scaleY, s.scaleZ],
      c = l.length / 3,
      a = new Float64Array(3 * c);
    for (let e = 0; e < c; e++) a[3 * e] = l[3 * e] * u[0] + i[0], a[3 * e + 1] = l[3 * e + 1] * u[1] + i[1], a[3 * e + 2] = l[3 * e + 2] * u[2] + i[2];
    return a;
  }
  if ("lepcc-xyz" === e.encoding) return (0,_LEPCC_js__WEBPACK_IMPORTED_MODULE_5__.decodeXYZ)(r).result;
}
function c(e, r, o) {
  return e?.attributeInfo.useElevation ? r ? a(r, o) : null : e?.attributeInfo.storageInfo ? (0,_I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_4__.readBinaryAttribute)(e.attributeInfo.storageInfo, e.buffer, o) : null;
}
function a(e, r) {
  const o = new Float64Array(r);
  for (let t = 0; t < r; t++) o[t] = e[3 * t + 2];
  return o;
}
function f(e, r, o, t, n) {
  const l = e.length / 3;
  let s = 0;
  for (let i = 0; i < l; i++) {
    let l = !0;
    for (let e = 0; e < t.length && l; e++) {
      const {
          filterJSON: r
        } = t[e],
        o = n[e].values[i];
      switch (r.type) {
        case "pointCloudValueFilter":
          {
            const e = "exclude" === r.mode;
            r.values.includes(o) === e && (l = !1);
            break;
          }
        case "pointCloudBitfieldFilter":
          {
            const e = p(r.requiredSetBits),
              t = p(r.requiredClearBits);
            (o & e) === e && 0 == (o & t) || (l = !1);
            break;
          }
        case "pointCloudReturnFilter":
          {
            const e = 15 & o,
              t = o >>> 4 & 15,
              n = t > 1,
              s = 1 === e,
              i = e === t;
            let u = !1;
            for (const o of r.includedReturns) if ("last" === o && i || "firstOfMany" === o && s && n || "lastOfMany" === o && i && n || "single" === o && !n) {
              u = !0;
              break;
            }
            u || (l = !1);
            break;
          }
      }
    }
    l && (o[s] = i, e[3 * s] = e[3 * i], e[3 * s + 1] = e[3 * i + 1], e[3 * s + 2] = e[3 * i + 2], r[3 * s] = r[3 * i], r[3 * s + 1] = r[3 * i + 1], r[3 * s + 2] = r[3 * i + 2], s++);
  }
  return s;
}
function d(e) {
  switch (e) {
    default:
    case null:
    case "none":
      return e => e;
    case "low-four-bit":
      return e => 15 & e;
    case "high-four-bit":
      return e => (240 & e) >> 4;
    case "absolute-value":
      return e => Math.abs(e);
    case "modulo-ten":
      return e => e % 10;
  }
}
function p(e) {
  let r = 0;
  for (const o of e || []) r |= 1 << o;
  return r;
}


/***/ })

}]);
//# sourceMappingURL=node_modules_arcgis_core_views_3d_layers_PointCloudWorker_js.js.map