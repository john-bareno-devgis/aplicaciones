"use strict";
(self["webpackChunkrealgis"] = self["webpackChunkrealgis"] || []).push([["node_modules_arcgis_core_views_2d_layers_features_support_FeatureFilter_js"],{

/***/ 91667:
/*!*************************************************************************************!*\
  !*** ./node_modules/@arcgis/core/views/2d/layers/features/support/FeatureFilter.js ***!
  \*************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ p)
/* harmony export */ });
/* harmony import */ var _home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 71670);
/* harmony import */ var _core_Error_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../../core/Error.js */ 32995);
/* harmony import */ var _core_Logger_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../core/Logger.js */ 28191);
/* harmony import */ var _geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../../geometry/support/aaBoundingRect.js */ 6848);
/* harmony import */ var _geometry_support_boundsUtils_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../../geometry/support/boundsUtils.js */ 71949);
/* harmony import */ var _layers_graphics_data_queryUtils_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../../layers/graphics/data/queryUtils.js */ 10780);
/* harmony import */ var _layers_graphics_data_spatialQuerySupport_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../../layers/graphics/data/spatialQuerySupport.js */ 39138);
/* harmony import */ var _layers_graphics_data_timeSupport_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../../layers/graphics/data/timeSupport.js */ 22262);
/* harmony import */ var _rest_support_Query_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../../rest/support/Query.js */ 28665);
/* harmony import */ var _FeatureStore2D_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../FeatureStore2D.js */ 59690);
/* harmony import */ var _whereUtils_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./whereUtils.js */ 94538);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/










const d = 1,
  m = 2;
class p {
  constructor(t) {
    this._geometryBounds = (0,_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_3__.create)(), this._idToVisibility = new Map(), this._serviceInfo = t;
  }
  get hash() {
    return this._hash;
  }
  check(t) {
    return this._applyFilter(t);
  }
  clear() {
    const t = this._resetAllHiddenIds();
    return this.update(), {
      show: t,
      hide: []
    };
  }
  invalidate() {
    this._idToVisibility.forEach((t, e) => {
      this._idToVisibility.set(e, 0);
    });
  }
  setKnownIds(t) {
    for (const e of t) this._idToVisibility.set(e, d);
  }
  setTrue(t) {
    const e = [],
      i = [],
      s = new Set(t);
    return this._idToVisibility.forEach((t, r) => {
      const o = !!(this._idToVisibility.get(r) & d),
        h = s.has(r);
      !o && h ? e.push(r) : o && !h && i.push(r), this._idToVisibility.set(r, h ? d | m : 0);
    }), {
      show: e,
      hide: i
    };
  }
  createQuery() {
    const {
      geometry: t,
      spatialRel: e,
      where: i,
      timeExtent: s,
      objectIds: r
    } = this;
    return _rest_support_Query_js__WEBPACK_IMPORTED_MODULE_8__["default"].fromJSON({
      geometry: t,
      spatialRel: e,
      where: i,
      timeExtent: s,
      objectIds: r
    });
  }
  update(t, e) {
    var _this = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      _this._hash = JSON.stringify(t);
      const i = yield (0,_layers_graphics_data_queryUtils_js__WEBPACK_IMPORTED_MODULE_5__.normalizeQueryLike)(t, null, e);
      yield Promise.all([_this._setGeometryFilter(i), _this._setIdFilter(i), _this._setAttributeFilter(i), _this._setTimeFilter(i)]);
    })();
  }
  _setAttributeFilter(t) {
    var _this2 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      if (!t?.where) return _this2._clause = null, void (_this2.where = null);
      _this2._clause = yield (0,_whereUtils_js__WEBPACK_IMPORTED_MODULE_10__.createWhereClause)(t.where, _this2._serviceInfo.fieldsIndex), _this2.where = t.where;
    })();
  }
  _setIdFilter(t) {
    this._idsToShow = t?.objectIds && new Set(t.objectIds), this._idsToHide = t?.hiddenIds && new Set(t.hiddenIds), this.objectIds = t?.objectIds;
  }
  _setGeometryFilter(t) {
    var _this3 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      if (!t?.geometry) return _this3._spatialQueryOperator = null, _this3.geometry = null, void (_this3.spatialRel = null);
      const e = t.geometry,
        i = t.spatialRel || "esriSpatialRelIntersects",
        r = yield (0,_layers_graphics_data_spatialQuerySupport_js__WEBPACK_IMPORTED_MODULE_6__.getSpatialQueryOperator)(i, e, _this3._serviceInfo.geometryType, _this3._serviceInfo.hasZ, _this3._serviceInfo.hasM);
      (0,_geometry_support_boundsUtils_js__WEBPACK_IMPORTED_MODULE_4__.getBoundsXY)(_this3._geometryBounds, e), _this3._spatialQueryOperator = r, _this3.geometry = e, _this3.spatialRel = i;
    })();
  }
  _setTimeFilter(i) {
    if (this.timeExtent = this._timeOperator = null, i?.timeExtent) if (this._serviceInfo.timeInfo) this.timeExtent = i.timeExtent, this._timeOperator = (0,_layers_graphics_data_timeSupport_js__WEBPACK_IMPORTED_MODULE_7__.getTimeOperator)(this._serviceInfo.timeInfo, i.timeExtent, _FeatureStore2D_js__WEBPACK_IMPORTED_MODULE_9__.featureAdapter);else {
      const s = new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__["default"]("feature-layer-view:time-filter-not-available", "Unable to apply time filter, as layer doesn't have time metadata.", i.timeExtent);
      _core_Logger_js__WEBPACK_IMPORTED_MODULE_2__["default"].getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(s);
    }
  }
  _applyFilter(t) {
    return this._filterByGeometry(t) && this._filterById(t) && this._filterByTime(t) && this._filterByExpression(t);
  }
  _filterByExpression(t) {
    return !this.where || this._clause(t);
  }
  _filterById(t) {
    return (!this._idsToHide?.size || !this._idsToHide.has(t.getObjectId())) && (!this._idsToShow?.size || this._idsToShow.has(t.getObjectId()));
  }
  _filterByGeometry(t) {
    if (!this.geometry) return !0;
    const e = t.readHydratedGeometry();
    return !!e && this._spatialQueryOperator(e);
  }
  _filterByTime(t) {
    return null == this._timeOperator || this._timeOperator(t);
  }
  _resetAllHiddenIds() {
    const t = [];
    return this._idToVisibility.forEach((e, i) => {
      e & d || (this._idToVisibility.set(i, d), t.push(i));
    }), t;
  }
}


/***/ }),

/***/ 94538:
/*!**********************************************************************************!*\
  !*** ./node_modules/@arcgis/core/views/2d/layers/features/support/whereUtils.js ***!
  \**********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "createWhereClause": () => (/* binding */ s)
/* harmony export */ });
/* harmony import */ var _home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 71670);
/* harmony import */ var _core_Error_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../../core/Error.js */ 32995);
/* harmony import */ var _core_Logger_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../core/Logger.js */ 28191);
/* harmony import */ var _core_sql_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../../core/sql.js */ 96204);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/



const a = _core_Logger_js__WEBPACK_IMPORTED_MODULE_2__["default"].getLogger("esri.views.2d.layers.features.support.whereUtils"),
  o = {
    getAttribute: (e, r) => e.readAttribute(r)
  };
function s(_x, _x2) {
  return _s.apply(this, arguments);
}
function _s() {
  _s = (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* (r, s) {
    try {
      const n = yield (0,_core_sql_js__WEBPACK_IMPORTED_MODULE_3__.parseWhereClause)(r, s);
      if (!n.isStandardized) {
        const r = new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__["default"]("mapview - bad input", "Unable to apply filter's definition expression, as expression is not standardized.", n);
        a.error(r);
      }
      return e => {
        const r = e.readArcadeFeature();
        return n.testFeature(r, o);
      };
    } catch (n) {
      return a.warn("mapview-bad-where-clause", "Encountered an error when evaluating where clause", r), e => !0;
    }
  });
  return _s.apply(this, arguments);
}


/***/ })

}]);
//# sourceMappingURL=node_modules_arcgis_core_views_2d_layers_features_support_FeatureFilter_js.js.map