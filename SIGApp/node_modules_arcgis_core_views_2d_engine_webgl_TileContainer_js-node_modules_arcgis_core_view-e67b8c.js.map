{"version":3,"file":"node_modules_arcgis_core_views_2d_engine_webgl_TileContainer_js-node_modules_arcgis_core_view-e67b8c.js","mappings":"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","sources":["./node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js","./node_modules/@arcgis/core/views/2d/engine/webgl/TiledDisplayObject.js","./node_modules/@arcgis/core/views/2d/layers/WMTSLayerView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport has from\"../../../../core/has.js\";import{WGLDrawPhase as e}from\"./enums.js\";import r from\"./WGLContainer.js\";import s from\"./brushes/WGLBrushInfo.js\";import t from\"./brushes/WGLBrushStencil.js\";const n=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;class i extends r{constructor(e){super(),this._tileInfoView=e}renderChildren(e){this.sortChildren(n),this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:r}=e,s=super.createRenderParams(e);return s.requiredLevel=this._tileInfoView.getClosestInfoForScale(r.scale).level,s.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(r.scale),s}prepareRenderPasses(r){const n=super.prepareRenderPasses(r);return n.push(r.registerRenderPass({name:\"stencil\",brushes:[t],drawPhase:e.DEBUG|e.MAP|e.HIGHLIGHT,target:()=>this.getStencilTarget()})),has(\"esri-tiles-debug\")&&n.push(r.registerRenderPass({name:\"tileInfo\",brushes:[s],drawPhase:e.DEBUG,target:()=>this.children})),n}getStencilTarget(){return this.children}setStencilReference(e){let r=1;for(const s of this.children)s.stencilRef=r++}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport{s as t,m as s}from\"../../../../chunks/mat3.js\";import{DisplayObject as i}from\"../DisplayObject.js\";import e from\"../../tiling/TileKey.js\";class r extends i{constructor(t,s,i,r,h,o,n=h,a=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new e(t),this.resolution=s,this.x=i,this.y=r,this.width=h,this.height=o,this.rangeX=n,this.rangeY=a}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(i){const e=this.resolution/(i.resolution*i.pixelRatio),r=this.transforms.tileMat3,[h,o]=i.toScreenNoRotation([0,0],[this.x,this.y]),n=this.width/this.rangeX*e,a=this.height/this.rangeY*e;t(r,n,0,0,0,a,0,h,o,1),s(this.transforms.dvs,i.displayViewMat3,r)}}export{r as TiledDisplayObject};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Logger.js\";import{isAbortError as i}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import{equals as a}from\"../../../geometry/support/spatialReferenceUtils.js\";import{BitmapTileLayerView2D as l}from\"./BitmapTileLayerView2D.js\";import{LayerView2DMixin as o}from\"./LayerView2D.js\";import{resampleImage as h}from\"./support/imageUtils.js\";import n from\"../tiling/TileInfoView.js\";import c from\"../tiling/TileKey.js\";import u from\"../tiling/TileQueue.js\";import p from\"../tiling/TileStrategy.js\";import f from\"../../layers/LayerView.js\";import m from\"../../layers/RefreshableLayerView.js\";const d=new Set([102113,102100,3857,3785,900913]),y=[0,0];let _=class extends(m(l(o(f)))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}get tileMatrixSet(){const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(e.id!==this.layer.activeLayer.tileMatrixSetId&&(this.layer.activeLayer.tileMatrixSetId=e.id),e):null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume()}attach(){const e=this.tileMatrixSet?.tileInfo;e&&(this._tileInfoView=new n(e),this._fetchQueue=new u({tileInfoView:this._tileInfoView,concurrency:16,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new p({cachePolicy:\"keep\",resampling:!0,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.addAttachHandles(this._updatingHandles.add((()=>[this.layer?.activeLayer?.styleId,this.tileMatrixSet]),(()=>this.doRefresh()))),super.attach())}detach(){super.detach(),this._tileStrategy?.destroy(),this._fetchQueue?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return this.layer.activeLayer.tileMatrixSets?.some((t=>a(t.tileInfo?.spatialReference,e)))??!1}async doRefresh(){if(this.attached){if(this.suspended)return this._tileStrategy.clear(),void this.requestUpdate();this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updatingHandles.addPromise(this._enqueueTileFetch(e))))}}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(y,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(t)),this._bitmapView.addChild(t),this.requestUpdate(),t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,t={}){const s=\"tilemapCache\"in this.layer?this.layer.tilemapCache:null,{signal:r,resamplingLevel:a=0}=t;if(!s)return this._fetchImage(e,r);const l=new c(0,0,0,0);let o;try{await s.fetchAvailabilityUpsample(e.level,e.row,e.col,l,{signal:r}),o=await this._fetchImage(l,r)}catch(n){if(i(n))throw n;if(a<3){const i=this._tileInfoView.getTileParentId(e.id);if(i){const s=new c(i),r=await this.fetchTile(s,{...t,resamplingLevel:a+1});return h(this._tileInfoView,r,s,e)}}throw n}return h(this._tileInfoView,o,l,e)}canResume(){const e=super.canResume();return e?null!==this.tileMatrixSet:e}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once(\"attach\",(()=>this.requestUpdate()))}catch(s){i(s)||t.getLogger(this).error(s)}this.requestUpdate()}}async _fetchImage(e,t){return this.layer.fetchImageBitmapTile(e.level,e.row,e.col,{signal:t})}_getTileMatrixSetBySpatialReference(e){const t=this.view.spatialReference;if(!e.tileMatrixSets)return null;let i=e.tileMatrixSets.find((e=>a(e.tileInfo?.spatialReference,t)));return!i&&t.isWebMercator&&(i=e.tileMatrixSets.find((e=>d.has(e.tileInfo?.spatialReference.wkid??-1)))),i}};e([s({readOnly:!0})],_.prototype,\"tileMatrixSet\",null),_=e([r(\"esri.views.2d.layers.WMTSLayerView2D\")],_);const w=_;export{w as default};\n"],"names":["has","WGLDrawPhase","e","r","s","t","n","key","level","row","col","i","constructor","_tileInfoView","renderChildren","sortChildren","setStencilReference","createRenderParams","state","requiredLevel","getClosestInfoForScale","scale","displayLevel","tileInfo","scaleToZoom","prepareRenderPasses","push","registerRenderPass","name","brushes","drawPhase","DEBUG","MAP","HIGHLIGHT","target","getStencilTarget","children","stencilRef","default","m","DisplayObject","h","o","a","triangleCountReportedInDebug","triangleCount","texture","resolution","x","y","width","height","rangeX","rangeY","destroy","dispose","setTransform","pixelRatio","transforms","tileMat3","toScreenNoRotation","dvs","displayViewMat3","TiledDisplayObject","_","isAbortError","property","subclass","equals","BitmapTileLayerView2D","l","LayerView2DMixin","resampleImage","c","u","p","f","d","Set","arguments","_tileStrategy","_fetchQueue","layer","tileMatrixSet","_getTileMatrixSetBySpatialReference","activeLayer","id","tileMatrixSetId","update","pause","resume","attach","tileInfoView","concurrency","process","fetchTile","cachePolicy","resampling","acquireTile","releaseTile","addAttachHandles","_updatingHandles","add","styleId","doRefresh","detach","moveStart","requestUpdate","viewChange","moveEnd","supportsSpatialReference","tileMatrixSets","some","spatialReference","attached","suspended","clear","reset","refresh","addPromise","_enqueueTileFetch","_bitmapView","createTile","bitmap","getTileCoords","getTileResolution","size","addChild","abort","removeChild","once","tilemapCache","signal","resamplingLevel","_fetchImage","fetchAvailabilityUpsample","getTileParentId","canResume","source","getLogger","error","fetchImageBitmapTile","view","find","isWebMercator","wkid","readOnly","prototype","w"],"sourceRoot":"webpack:///","x_google_ignoreList":[0,1,2]}