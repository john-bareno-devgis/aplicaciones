"use strict";
(self["webpackChunkrealgis"] = self["webpackChunkrealgis"] || []).push([["node_modules_arcgis_core_layers_graphics_sources_support_MemorySourceWorker_js"],{

/***/ 55168:
/*!*****************************************************************************************!*\
  !*** ./node_modules/@arcgis/core/layers/graphics/sources/support/MemorySourceWorker.js ***!
  \*****************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ S)
/* harmony export */ });
/* harmony import */ var _home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 71670);
/* harmony import */ var _core_Error_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../core/Error.js */ 32995);
/* harmony import */ var _geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../geometry/support/jsonUtils.js */ 71182);
/* harmony import */ var _geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../geometry/support/spatialReferenceUtils.js */ 53492);
/* harmony import */ var _featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../featureConversionUtils.js */ 50805);
/* harmony import */ var _objectIdUtils_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../objectIdUtils.js */ 26793);
/* harmony import */ var _data_FeatureStore_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../data/FeatureStore.js */ 92203);
/* harmony import */ var _data_projectionSupport_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../data/projectionSupport.js */ 19482);
/* harmony import */ var _data_QueryEngine_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../data/QueryEngine.js */ 59266);
/* harmony import */ var _clientSideDefaults_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./clientSideDefaults.js */ 34524);
/* harmony import */ var _sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./sourceUtils.js */ 65210);
/* harmony import */ var _support_FieldsIndex_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../support/FieldsIndex.js */ 19346);
/* harmony import */ var _support_fieldType_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../support/fieldType.js */ 43651);
/* harmony import */ var _support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../support/fieldUtils.js */ 32746);
/* harmony import */ var _time_timeZoneUtils_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../time/timeZoneUtils.js */ 92691);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/














const R = _geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_3__.WGS84,
  q = {
    xmin: -180,
    ymin: -90,
    xmax: 180,
    ymax: 90,
    spatialReference: _geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_3__.WGS84
  },
  D = {
    hasAttachments: !1,
    capabilities: "query, editing, create, delete, update",
    useStandardizedQueries: !0,
    supportsCoordinatesQuantization: !0,
    supportsReturningQueryGeometry: !0,
    advancedQueryCapabilities: {
      supportsQueryAttachments: !1,
      supportsStatistics: !0,
      supportsPercentileStatistics: !0,
      supportsReturningGeometryCentroid: !0,
      supportsQueryWithDistance: !0,
      supportsDistinct: !0,
      supportsReturningQueryExtent: !0,
      supportsReturningGeometryProperties: !1,
      supportsHavingClause: !0,
      supportsOrderBy: !0,
      supportsPagination: !0,
      supportsQueryWithResultType: !1,
      supportsSqlExpression: !0,
      supportsDisjointSpatialRel: !0
    }
  };
function O(e) {
  return (0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_2__.isPoint)(e) ? null != e.z : !!e.hasZ;
}
function w(e) {
  return (0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_2__.isPoint)(e) ? null != e.m : !!e.hasM;
}
class S {
  constructor() {
    this._queryEngine = null, this._nextObjectId = null;
  }
  destroy() {
    this._queryEngine?.destroy(), this._queryEngine = this._createDefaultAttributes = null;
  }
  load(t) {
    var _this = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      const i = [],
        {
          features: s
        } = t,
        n = _this._inferLayerProperties(s, t.fields),
        r = t.fields || [],
        a = null != t.hasM ? t.hasM : !!n.hasM,
        p = null != t.hasZ ? t.hasZ : !!n.hasZ,
        h = !t.spatialReference && !n.spatialReference,
        g = h ? R : t.spatialReference || n.spatialReference,
        I = h ? q : null,
        F = t.geometryType || n.geometryType,
        b = !F;
      let O = t.objectIdField || n.objectIdField,
        w = t.timeInfo;
      const S = new _support_FieldsIndex_js__WEBPACK_IMPORTED_MODULE_11__["default"](r);
      if (!b && (h && i.push({
        name: "feature-layer:spatial-reference-not-found",
        message: "Spatial reference not provided or found in features. Defaults to WGS84"
      }), !F)) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__["default"]("feature-layer:missing-property", "geometryType not set and couldn't be inferred from the provided features");
      if (!O) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__["default"]("feature-layer:missing-property", "objectIdField not set and couldn't be found in the provided fields");
      if (n.objectIdField && O !== n.objectIdField && (i.push({
        name: "feature-layer:duplicated-oid-field",
        message: `Provided objectIdField "${O}" doesn't match the field name "${n.objectIdField}", found in the provided fields`
      }), O = n.objectIdField), O && !n.objectIdField) {
        const e = S.get(O);
        e ? (O = e.name, e.type = "esriFieldTypeOID", e.editable = !1, e.nullable = !1) : r.unshift({
          alias: O,
          name: O,
          type: "esriFieldTypeOID",
          editable: !1,
          nullable: !1
        });
      }
      for (const o of r) {
        if (null == o.name && (o.name = o.alias), null == o.alias && (o.alias = o.name), !o.name) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__["default"]("feature-layer:invalid-field-name", "field name is missing", {
          field: o
        });
        if (o.name === O && (o.type = "esriFieldTypeOID"), !_support_fieldType_js__WEBPACK_IMPORTED_MODULE_12__.kebabDict.jsonValues.includes(o.type)) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__["default"]("feature-layer:invalid-field-type", `invalid type for field "${o.name}"`, {
          field: o
        });
        null == o.length && (o.length = (0,_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_13__.getFieldDefaultLength)(o));
      }
      const v = {};
      for (const e of r) if ("esriFieldTypeOID" !== e.type && "esriFieldTypeGlobalID" !== e.type) {
        const t = (0,_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_13__.getFieldDefaultValue)(e);
        void 0 !== t && (v[e.name] = t);
      }
      if (w) {
        if (w.startTimeField) {
          const e = S.get(w.startTimeField);
          e ? (w.startTimeField = e.name, e.type = "esriFieldTypeDate") : w.startTimeField = null;
        }
        if (w.endTimeField) {
          const e = S.get(w.endTimeField);
          e ? (w.endTimeField = e.name, e.type = "esriFieldTypeDate") : w.endTimeField = null;
        }
        if (w.trackIdField) {
          const e = S.get(w.trackIdField);
          e ? w.trackIdField = e.name : (w.trackIdField = null, i.push({
            name: "feature-layer:invalid-timeInfo-trackIdField",
            message: "trackIdField is missing",
            details: {
              timeInfo: w
            }
          }));
        }
        w.startTimeField || w.endTimeField || (i.push({
          name: "feature-layer:invalid-timeInfo",
          message: "startTimeField and endTimeField are missing or invalid",
          details: {
            timeInfo: w
          }
        }), w = null);
      }
      const Q = S.dateFields.length ? {
        timeZoneIANA: t.dateFieldsTimeZone ?? _time_timeZoneUtils_js__WEBPACK_IMPORTED_MODULE_14__.utc
      } : null;
      _this._createDefaultAttributes = (0,_clientSideDefaults_js__WEBPACK_IMPORTED_MODULE_9__.createDefaultAttributesFunction)(v, O);
      const M = {
        warnings: i,
        featureErrors: [],
        layerDefinition: {
          ...D,
          drawingInfo: (0,_clientSideDefaults_js__WEBPACK_IMPORTED_MODULE_9__.createDrawingInfo)(F),
          templates: (0,_clientSideDefaults_js__WEBPACK_IMPORTED_MODULE_9__.createDefaultTemplate)(v),
          extent: I,
          geometryType: F,
          objectIdField: O,
          fields: r,
          hasZ: p,
          hasM: a,
          timeInfo: w,
          dateFieldsTimeReference: Q
        },
        assignedObjectIds: {}
      };
      if (_this._queryEngine = new _data_QueryEngine_js__WEBPACK_IMPORTED_MODULE_8__.QueryEngine({
        fieldsIndex: _support_FieldsIndex_js__WEBPACK_IMPORTED_MODULE_11__["default"].fromLayerJSON({
          fields: r,
          timeInfo: w,
          dateFieldsTimeReference: Q
        }),
        geometryType: F,
        hasM: a,
        hasZ: p,
        objectIdField: O,
        spatialReference: g,
        featureStore: new _data_FeatureStore_js__WEBPACK_IMPORTED_MODULE_6__["default"]({
          geometryType: F,
          hasM: a,
          hasZ: p
        }),
        timeInfo: w,
        cacheSpatialQueries: !0
      }), !s?.length) return _this._nextObjectId = _objectIdUtils_js__WEBPACK_IMPORTED_MODULE_5__.initialObjectId, M;
      const Z = (0,_objectIdUtils_js__WEBPACK_IMPORTED_MODULE_5__.findLastObjectIdFromFeatures)(O, s);
      return _this._nextObjectId = Z + 1, yield (0,_data_projectionSupport_js__WEBPACK_IMPORTED_MODULE_7__.checkProjectionSupport)(s, g), _this._loadInitialFeatures(M, s);
    })();
  }
  applyEdits(e) {
    var _this2 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      const {
        spatialReference: t,
        geometryType: i
      } = _this2._queryEngine;
      return yield Promise.all([(0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.loadGeometryEngineForSimplify)(t, i), (0,_data_projectionSupport_js__WEBPACK_IMPORTED_MODULE_7__.checkProjectionSupport)(e.adds, t), (0,_data_projectionSupport_js__WEBPACK_IMPORTED_MODULE_7__.checkProjectionSupport)(e.updates, t)]), _this2._applyEdits(e);
    })();
  }
  queryFeatures(e, t = {}) {
    return this._queryEngine.executeQuery(e, t.signal);
  }
  queryFeatureCount(e, t = {}) {
    return this._queryEngine.executeQueryForCount(e, t.signal);
  }
  queryObjectIds(e, t = {}) {
    return this._queryEngine.executeQueryForIds(e, t.signal);
  }
  queryExtent(e, t = {}) {
    return this._queryEngine.executeQueryForExtent(e, t.signal);
  }
  querySnapping(e, t = {}) {
    return this._queryEngine.executeQueryForSnapping(e, t.signal);
  }
  _inferLayerProperties(e, i) {
    let s,
      n,
      r = null,
      a = null,
      o = null;
    for (const l of e) {
      const e = l.geometry;
      if (null != e && (r || (r = (0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_2__.getJsonType)(e)), a || (a = e.spatialReference), null == s && (s = O(e)), null == n && (n = w(e)), r && a && null != s && null != n)) break;
    }
    if (i && i.length) {
      let e = null;
      i.some(t => {
        const i = "esriFieldTypeOID" === t.type,
          s = !t.type && t.name && "objectid" === t.name.toLowerCase();
        return e = t, i || s;
      }) && (o = e.name);
    }
    return {
      geometryType: r,
      spatialReference: a,
      objectIdField: o,
      hasM: n,
      hasZ: s
    };
  }
  _loadInitialFeatures(e, i) {
    var _this3 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      const {
          geometryType: s,
          hasM: r,
          hasZ: a,
          objectIdField: o,
          spatialReference: l,
          featureStore: u,
          fieldsIndex: d
        } = _this3._queryEngine,
        f = [];
      for (const n of i) {
        if (null != n.uid && (e.assignedObjectIds[n.uid] = -1), n.geometry && s !== (0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_2__.getJsonType)(n.geometry)) {
          e.featureErrors.push((0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.createFeatureEditErrorResult)("Incorrect geometry type."));
          continue;
        }
        const i = _this3._createDefaultAttributes(),
          r = (0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.mixAttributes)(d, i, n.attributes, !0);
        r ? e.featureErrors.push(r) : (_this3._assignObjectId(i, n.attributes, !0), n.attributes = i, null != n.uid && (e.assignedObjectIds[n.uid] = n.attributes[o]), null != n.geometry && (n.geometry = (0,_data_projectionSupport_js__WEBPACK_IMPORTED_MODULE_7__.project)(n.geometry, n.geometry.spatialReference, l)), f.push(n));
      }
      u.addMany((0,_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_4__.convertFromFeatures)([], f, s, a, r, o));
      const {
        fullExtent: c,
        timeExtent: m
      } = yield _this3._queryEngine.fetchRecomputedExtents();
      if (e.layerDefinition.extent = c, m) {
        const {
          start: t,
          end: i
        } = m;
        e.layerDefinition.timeInfo.timeExtent = [t, i];
      }
      return e;
    })();
  }
  _applyEdits(e) {
    var _this4 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      const {
          adds: t,
          updates: i,
          deletes: s
        } = e,
        n = {
          addResults: [],
          deleteResults: [],
          updateResults: [],
          uidToObjectId: {}
        };
      if (t?.length && _this4._applyAddEdits(n, t), i?.length && _this4._applyUpdateEdits(n, i), s?.length) {
        for (const e of s) n.deleteResults.push((0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.createFeatureEditSuccessResult)(e));
        _this4._queryEngine.featureStore.removeManyById(s);
      }
      const {
        fullExtent: r,
        timeExtent: a
      } = yield _this4._queryEngine.fetchRecomputedExtents();
      return {
        extent: r,
        timeExtent: a,
        featureEditResults: n
      };
    })();
  }
  _applyAddEdits(e, i) {
    const {
        addResults: s
      } = e,
      {
        geometryType: r,
        hasM: a,
        hasZ: o,
        objectIdField: l,
        spatialReference: u,
        featureStore: d,
        fieldsIndex: f
      } = this._queryEngine,
      c = [];
    for (const n of i) {
      if (n.geometry && r !== (0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_2__.getJsonType)(n.geometry)) {
        s.push((0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.createFeatureEditErrorResult)("Incorrect geometry type."));
        continue;
      }
      const i = this._createDefaultAttributes(),
        a = (0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.mixAttributes)(f, i, n.attributes);
      if (a) s.push(a);else {
        if (this._assignObjectId(i, n.attributes), n.attributes = i, null != n.uid) {
          const t = n.attributes[l];
          e.uidToObjectId[n.uid] = t;
        }
        if (null != n.geometry) {
          const e = n.geometry.spatialReference ?? u;
          n.geometry = (0,_data_projectionSupport_js__WEBPACK_IMPORTED_MODULE_7__.project)((0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.simplify)(n.geometry, e), e, u);
        }
        c.push(n), s.push((0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.createFeatureEditSuccessResult)(n.attributes[l]));
      }
    }
    d.addMany((0,_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_4__.convertFromFeatures)([], c, r, o, a, l));
  }
  _applyUpdateEdits({
    updateResults: e
  }, i) {
    const {
      geometryType: s,
      hasM: n,
      hasZ: o,
      objectIdField: l,
      spatialReference: u,
      featureStore: d,
      fieldsIndex: f
    } = this._queryEngine;
    for (const c of i) {
      const {
          attributes: i,
          geometry: m
        } = c,
        y = i?.[l];
      if (null == y) {
        e.push((0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.createFeatureEditErrorResult)(`Identifier field ${l} missing`));
        continue;
      }
      if (!d.has(y)) {
        e.push((0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.createFeatureEditErrorResult)(`Feature with object id ${y} missing`));
        continue;
      }
      const h = (0,_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_4__.convertToFeature)(d.getFeature(y), s, o, n);
      if (null != m) {
        if (s !== (0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_2__.getJsonType)(m)) {
          e.push((0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.createFeatureEditErrorResult)("Incorrect geometry type."));
          continue;
        }
        const i = m.spatialReference ?? u;
        h.geometry = (0,_data_projectionSupport_js__WEBPACK_IMPORTED_MODULE_7__.project)((0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.simplify)(m, i), i, u);
      }
      if (i) {
        const t = (0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.mixAttributes)(f, h.attributes, i);
        if (t) {
          e.push(t);
          continue;
        }
      }
      d.add((0,_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_4__.convertFromFeature)(h, s, o, n, l)), e.push((0,_sourceUtils_js__WEBPACK_IMPORTED_MODULE_10__.createFeatureEditSuccessResult)(y));
    }
  }
  _assignObjectId(e, t, i = !1) {
    const s = this._queryEngine.objectIdField;
    i && t && isFinite(t[s]) ? e[s] = t[s] : e[s] = this._nextObjectId++;
  }
}


/***/ })

}]);
//# sourceMappingURL=node_modules_arcgis_core_layers_graphics_sources_support_MemorySourceWorker_js.js.map