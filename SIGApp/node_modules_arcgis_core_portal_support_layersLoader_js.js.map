{"version":3,"file":"node_modules_arcgis_core_portal_support_layersLoader_js.js","mappings":"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","sources":["./node_modules/@arcgis/core/portal/support/layersLoader.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{parse as t}from\"../../layers/support/arcgisLayerUrl.js\";import{fetchFeatureService as r}from\"../../layers/support/fetchService.js\";import{LayerLoadContext as a}from\"../../layers/support/LayerLoadContext.js\";import{populateGroupLayer as n}from\"../../layers/support/layersCreator.js\";import{layerLookupMap as o}from\"../../layers/support/lazyLayerLoader.js\";import s from\"../Portal.js\";import{createForItemRead as l,createForGroupLayerItemRead as i}from\"./jsonContext.js\";import{preprocessFSItemData as p,getSubtypeGroupLayerIds as u,getOrientedImageryLayerIds as c,populateSceneServiceItemData as y,getNumLayersAndTables as f,createSublayerData as d,getFirstLayerOrTableId as m}from\"./loadUtils.js\";import{hasTypeKeyword as h}from\"./portalItemUtils.js\";import{loadStyleRenderer as w}from\"../../renderers/support/styleUtils.js\";import{fetchArcGISServiceJSON as b}from\"../../support/requestPresets.js\";async function g(e,t){const r=e.instance.portalItem;if(r?.id)return await r.load(t),I(e),L(e,t)}function I(t){const r=t.instance.portalItem;if(!r?.type||!t.supportedTypes.includes(r.type))throw new e(\"portal:invalid-layer-item-type\",\"Invalid layer item type '${type}', expected '${expectedType}'\",{type:r?.type,expectedType:t.supportedTypes.join(\", \")})}async function L(e,t){const r=e.instance,n=r.portalItem;if(!n)return;const{url:o,title:s}=n,i=l(n);if(\"group\"===r.type)return S(r,i,e);o&&r.read({url:o},i);const p=new a,u=await F(e,p,t);return u&&r.read(u,i),r.resourceReferences={portalItem:n,paths:i.readResourcePaths??[]},\"subtype-group\"!==r.type&&r.read({title:s},i),w(r,i)}async function S(t,r,a){const n=t.portalItem;if(!t.sourceIsPortalItem)return;const{title:o,type:s}=n;if(\"Group Layer\"===s){if(!h(n,\"Map\"))throw new e(\"portal:invalid-layer-item-typekeyword\",\"'Group Layer' item without 'Map' type keyword is not supported\");return T(t)}return t.read({title:o},r),j(t,a)}async function T(e){const t=e.portalItem,r=await t.fetchData(\"json\");if(!r)return;const a=i(t);e.read(r,a),await n(e,r,{context:a}),e.resourceReferences={portalItem:t,paths:a.readResourcePaths??[]}}async function j(t,r){let n;const{portalItem:o}=t;if(!o)return;const s=o.type,l=r.layerModuleTypeMap;switch(s){case\"Feature Service\":case\"Feature Collection\":n=l.FeatureLayer;break;case\"Stream Service\":n=l.StreamLayer;break;case\"Scene Service\":n=l.SceneLayer;break;default:throw new e(\"portal:unsupported-item-type-as-group\",`The item type '${s}' is not supported as a 'IGroupLayer'`)}const i=new a;let[d,m]=await Promise.all([n(),F(r,i)]),h=()=>d;if(\"Feature Service\"===s){m=o.url?await p(m,o.url,i):{};const e=u(m),r=c(m),a=[];if(e.length||r?.length){e.length&&a.push(\"SubtypeGroupLayer\"),r?.length&&a.push(\"OrientedImageryLayer\");const t=[];for(const e of a){const r=l[e];t.push(r())}const n=await Promise.all(t),o=new Map;a.forEach(((e,t)=>{o.set(e,n[t])})),h=e=>e.layerType?o.get(e.layerType)??d:d}const n=await E(o.url);return await M(t,h,m,n)}return\"Scene Service\"===s&&o.url&&(m=await y(o,m,i)),f(m)>0?await M(t,h,m):await v(t,h)}async function v(e,t){const{portalItem:r}=e;if(!r?.url)return;const a=await b(r.url);a&&M(e,t,{layers:a.layers?.map(d),tables:a.tables?.map(d)})}async function M(e,t,r,a){let n=r.layers||[];const s=r.tables||[];if(\"Feature Collection\"===e.portalItem?.type?(n.forEach(((e,t)=>{e.id=t,\"Table\"===e?.layerDefinition?.type&&s.push(e)})),n=n.filter((e=>\"Table\"!==e?.layerDefinition?.type))):(n.reverse(),s.reverse()),n.forEach((n=>{const o=a?.(n);if(o||!a){const a=x(e,t(n),r,n,o);e.add(a)}})),s.length){const t=await o.FeatureLayer();s.forEach((n=>{const o=a?.(n);if(o||!a){const a=x(e,t,r,n,o);e.tables.add(a)}}))}}function x(e,t,r,a,n){const o=e.portalItem,l={portalItem:o.clone(),layerId:a.id};null!=a.url&&(l.url=a.url);const i=new t(l);if(\"sourceJSON\"in i&&(i.sourceJSON=n),\"subtype-group\"!==i.type&&(i.sublayerTitleMode=\"service-name\"),\"Feature Collection\"===o.type){const e={origin:\"portal-item\",portal:o.portal||s.getDefault()};i.read(a,e);const t=r.showLegend;null!=t&&i.read({showLegend:t},e)}return i}async function F(e,t,r){if(!1===e.supportsData)return;const a=e.instance,n=a.portalItem;if(!n)return;let o=null;try{o=await n.fetchData(\"json\",r)}catch(s){}if(D(a)){let e=null;const r=await P(n,o,t);if((o?.layers||o?.tables)&&r>0){if(null==a.layerId){const e=u(o);a.layerId=\"subtype-group\"===a.type?e?.[0]:m(o)}e=C(o,a),e&&null!=o.showLegend&&(e.showLegend=o.showLegend)}return r>1&&\"sublayerTitleMode\"in a&&\"service-name\"!==a.sublayerTitleMode&&(a.sublayerTitleMode=\"item-title-and-service-name\"),e}return o}async function P(e,r,a){if(r?.layers&&r?.tables)return f(r);const n=t(e.url);if(!n)return 1;const o=await a.fetchServiceMetadata(n.url.path).catch((()=>null));return(r?.layers?.length??o?.layers?.length??0)+(r?.tables?.length??o?.tables?.length??0)}function C(e,t){const{layerId:r}=t,a=e.layers?.find((e=>e.id===r))||e.tables?.find((e=>e.id===r));return a&&k(a,t)?a:null}function D(e){return\"stream\"!==e.type&&\"layerId\"in e}function k(e,t){return!(\"feature\"===t.type&&\"layerType\"in e&&\"SubtypeGroupLayer\"===e.layerType||\"subtype-group\"===t.type&&!(\"layerType\"in e))}async function E(e){const{layersJSON:t}=await r(e);if(!t)return null;const a=[...t.layers,...t.tables];return e=>a.find((t=>t.id===e.id))}export{g as load};\n"],"names":["e","parse","t","fetchFeatureService","r","LayerLoadContext","a","populateGroupLayer","n","layerLookupMap","o","s","createForItemRead","l","createForGroupLayerItemRead","i","preprocessFSItemData","p","getSubtypeGroupLayerIds","u","getOrientedImageryLayerIds","c","populateSceneServiceItemData","y","getNumLayersAndTables","f","createSublayerData","d","getFirstLayerOrTableId","m","hasTypeKeyword","h","loadStyleRenderer","w","fetchArcGISServiceJSON","b","g","instance","portalItem","id","load","I","L","type","supportedTypes","includes","expectedType","join","url","title","S","read","F","resourceReferences","paths","readResourcePaths","sourceIsPortalItem","T","j","fetchData","context","layerModuleTypeMap","FeatureLayer","StreamLayer","SceneLayer","Promise","all","length","push","Map","forEach","set","layerType","get","E","M","v","layers","map","tables","layerDefinition","filter","reverse","x","add","clone","layerId","sourceJSON","sublayerTitleMode","origin","portal","getDefault","showLegend","supportsData","D","P","C","fetchServiceMetadata","path","catch","find","k","layersJSON"],"sourceRoot":"webpack:///","x_google_ignoreList":[0]}