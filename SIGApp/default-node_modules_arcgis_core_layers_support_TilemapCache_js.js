"use strict";
(self["webpackChunkrealgis"] = self["webpackChunkrealgis"] || []).push([["default-node_modules_arcgis_core_layers_support_TilemapCache_js"],{

/***/ 54025:
/*!*****************************************************************!*\
  !*** ./node_modules/@arcgis/core/geometry/support/UintArray.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "newUintArray": () => (/* binding */ t),
/* harmony export */   "uintArrayFrom": () => (/* binding */ e),
/* harmony export */   "uintSubArray": () => (/* binding */ y)
/* harmony export */ });
/* harmony import */ var _core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../core/typedArrayUtil.js */ 13878);
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/

function t(n, t = !1) {
  return n <= _core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_0__.nativeArrayMaxSize ? t ? new Array(n).fill(0) : new Array(n) : new Uint32Array(n);
}
function e(t) {
  return ((0,_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_0__.isArray)(t) ? t.length : t.byteLength / 8) <= _core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_0__.nativeArrayMaxSize ? Array.from(t) : new Uint32Array(t);
}
function y(r, n, t) {
  return Array.isArray(r) ? r.slice(n, n + t) : r.subarray(n, n + t);
}


/***/ }),

/***/ 45963:
/*!*************************************************************!*\
  !*** ./node_modules/@arcgis/core/layers/support/Tilemap.js ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Tilemap": () => (/* binding */ r),
/* harmony export */   "tilemapDefinitionId": () => (/* binding */ n)
/* harmony export */ });
/* harmony import */ var _request_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../request.js */ 1897);
/* harmony import */ var _core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../core/arrayUtils.js */ 19420);
/* harmony import */ var _core_Error_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../core/Error.js */ 32995);
/* harmony import */ var _core_lang_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../core/lang.js */ 88684);
/* harmony import */ var _core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../core/typedArrayUtil.js */ 13878);
/* harmony import */ var _geometry_support_UintArray_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../geometry/support/UintArray.js */ 54025);
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/






class r {
  constructor(t) {
    this._validateJSON(t);
    const {
      location: i,
      data: e
    } = t;
    this.location = Object.freeze((0,_core_lang_js__WEBPACK_IMPORTED_MODULE_3__.clone)(i));
    const r = this.location.width,
      n = this.location.height;
    let s = !0,
      h = !0;
    const c = Math.ceil(r * n / 32),
      m = (0,_geometry_support_UintArray_js__WEBPACK_IMPORTED_MODULE_5__.newUintArray)(c);
    let f = 0;
    for (let a = 0; a < e.length; a++) {
      const t = a % 32;
      e[a] ? (h = !1, m[f] |= 1 << t) : s = !1, 31 === t && ++f;
    }
    h ? (this._availability = "unavailable", this.byteSize = 40) : s ? (this._availability = "available", this.byteSize = 40) : (this._availability = m, this.byteSize = 40 + (0,_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_4__.estimateSize)(m));
  }
  getAvailability(t, i) {
    if ("unavailable" === this._availability || "available" === this._availability) return this._availability;
    const e = (t - this.location.top) * this.location.width + (i - this.location.left),
      a = e % 32,
      o = e >> 5,
      l = this._availability;
    return o < 0 || o > l.length ? "unknown" : l[o] & 1 << a ? "available" : "unavailable";
  }
  static fromDefinition(a, o) {
    const l = a.service.request || _request_js__WEBPACK_IMPORTED_MODULE_0__["default"],
      {
        row: n,
        col: h,
        width: c,
        height: m
      } = a,
      f = {
        query: {
          f: "json"
        }
      };
    return o = o ? {
      ...f,
      ...o
    } : f, l(s(a), o).then(t => t.data).catch(t => {
      if (t && t.details && 422 === t.details.httpStatus) return {
        location: {
          top: n,
          left: h,
          width: c,
          height: m
        },
        valid: !0,
        data: (0,_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__.constant)(c * m, 0)
      };
      throw t;
    }).then(t => {
      if (t.location && (t.location.top !== n || t.location.left !== h || t.location.width !== c || t.location.height !== m)) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("tilemap:location-mismatch", "Tilemap response for different location than requested", {
        response: t,
        definition: {
          top: n,
          left: h,
          width: c,
          height: m
        }
      });
      return r.fromJSON(t);
    });
  }
  static fromJSON(t) {
    return Object.freeze(new r(t));
  }
  _validateJSON(t) {
    if (!t?.location) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("tilemap:missing-location", "Location missing from tilemap response");
    if (!1 === t.valid) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("tilemap:invalid", "Tilemap response was marked as invalid");
    if (!t.data) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("tilemap:missing-data", "Data missing from tilemap response");
    if (!Array.isArray(t.data)) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("tilemap:data-mismatch", "Data must be an array of numbers");
    if (t.data.length !== t.location.width * t.location.height) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("tilemap:data-mismatch", "Number of data items does not match width/height of tilemap");
  }
}
function n(t) {
  return `${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;
}
function s(t) {
  let i;
  if (t.service.tileServers?.length) {
    const e = t.service.tileServers;
    i = `${e && e.length ? e[t.row % e.length] : t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;
  } else i = `${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;
  const e = t.service.query;
  return e && (i = `${i}?${e}`), i;
}


/***/ }),

/***/ 75512:
/*!******************************************************************!*\
  !*** ./node_modules/@arcgis/core/layers/support/TilemapCache.js ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "TilemapCache": () => (/* binding */ T)
/* harmony export */ });
/* harmony import */ var _home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 71670);
/* harmony import */ var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../chunks/tslib.es6.js */ 18100);
/* harmony import */ var _request_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../request.js */ 1897);
/* harmony import */ var _core_Accessor_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../core/Accessor.js */ 2299);
/* harmony import */ var _core_ByteSizeUnit_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../core/ByteSizeUnit.js */ 55662);
/* harmony import */ var _core_Error_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../core/Error.js */ 32995);
/* harmony import */ var _core_handleUtils_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../core/handleUtils.js */ 70120);
/* harmony import */ var _core_LRUCache_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../core/LRUCache.js */ 61101);
/* harmony import */ var _core_PooledArray_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../core/PooledArray.js */ 99249);
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../core/promiseUtils.js */ 30801);
/* harmony import */ var _core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../core/reactiveUtils.js */ 7521);
/* harmony import */ var _core_scheduling_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../core/scheduling.js */ 91409);
/* harmony import */ var _core_urlUtils_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../core/urlUtils.js */ 55050);
/* harmony import */ var _core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../core/accessorSupport/decorators/property.js */ 9497);
/* harmony import */ var _core_accessorSupport_ensureType_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../core/accessorSupport/ensureType.js */ 83382);
/* harmony import */ var _core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../core/arrayUtils.js */ 19420);
/* harmony import */ var _core_has_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../core/has.js */ 67087);
/* harmony import */ var _core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../core/accessorSupport/decorators/subclass.js */ 20891);
/* harmony import */ var _TileKey_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./TileKey.js */ 45933);
/* harmony import */ var _Tilemap_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./Tilemap.js */ 45963);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/



















var w;
let T = w = class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_3__["default"] {
  constructor(e) {
    super(e), this._pendingTilemapRequests = {}, this.request = _request_js__WEBPACK_IMPORTED_MODULE_2__["default"], this.size = 32, this._prefetchingEnabled = !0;
  }
  initialize() {
    this._tilemapCache = new _core_LRUCache_js__WEBPACK_IMPORTED_MODULE_7__.LRUCache(2 * _core_ByteSizeUnit_js__WEBPACK_IMPORTED_MODULE_4__.ByteSizeUnit.MEGABYTES), this.addHandles([(0,_core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_10__.watch)(() => {
      const {
        layer: e
      } = this;
      return [e?.parsedUrl, e?.tileServers, e?.apiKey, e?.customParameters];
    }, () => this._initializeTilemapDefinition(), _core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_10__.initial)]);
  }
  get effectiveMinLOD() {
    return this.minLOD ?? this.layer.tileInfo.lods[0].level;
  }
  get effectiveMaxLOD() {
    return this.maxLOD ?? this.layer.tileInfo.lods[this.layer.tileInfo.lods.length - 1].level;
  }
  fetchTilemap(e, t, i, r) {
    if (!this.layer.tileInfo.lodAt(e) || e < this.effectiveMinLOD || e > this.effectiveMaxLOD) return Promise.reject(new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__["default"]("tilemap-cache:level-unavailable", `Level ${e} is unavailable in the service`));
    const l = this._tmpTilemapDefinition,
      o = this._tilemapFromCache(e, t, i, l);
    if (o) return Promise.resolve(o);
    const a = r?.signal;
    return r = {
      ...r,
      signal: null
    }, new Promise((e, t) => {
      (0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.onAbort)(a, () => t((0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.createAbortError)()));
      const i = (0,_Tilemap_js__WEBPACK_IMPORTED_MODULE_19__.tilemapDefinitionId)(l);
      let s = this._pendingTilemapRequests[i];
      if (!s) {
        s = _Tilemap_js__WEBPACK_IMPORTED_MODULE_19__.Tilemap.fromDefinition(l, r).then(e => (this._tilemapCache.put(i, e, e.byteSize), e));
        const e = () => {
          delete this._pendingTilemapRequests[i];
        };
        this._pendingTilemapRequests[i] = s, s.then(e, e);
      }
      s.then(e, t);
    });
  }
  getAvailability(e, t, i) {
    if (!this.layer.tileInfo.lodAt(e) || e < this.effectiveMinLOD || e > this.effectiveMaxLOD) return "unavailable";
    const r = this._tilemapFromCache(e, t, i, this._tmpTilemapDefinition);
    return r ? r.getAvailability(t, i) : "unknown";
  }
  fetchAvailability(e, t, i, r) {
    return !this.layer.tileInfo.lodAt(e) || e < this.effectiveMinLOD || e > this.effectiveMaxLOD ? Promise.reject(new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__["default"]("tile-map:tile-unavailable", "Tile is not available", {
      level: e,
      row: t,
      col: i
    })) : this.fetchTilemap(e, t, i, r).catch(e => e).then(r => {
      if (r instanceof _Tilemap_js__WEBPACK_IMPORTED_MODULE_19__.Tilemap) {
        const l = r.getAvailability(t, i);
        if ("unavailable" === l) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_5__["default"]("tile-map:tile-unavailable", "Tile is not available", {
          level: e,
          row: t,
          col: i
        });
        return l;
      }
      if ((0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.isAbortError)(r)) throw r;
      return "unknown";
    });
  }
  fetchAvailabilityUpsample(e, t, i, r, s) {
    r.level = e, r.row = t, r.col = i;
    const l = this.layer.tileInfo;
    l.updateTileInfo(r);
    const o = this.fetchAvailability(e, t, i, s).catch(e => {
      if ((0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.isAbortError)(e)) throw e;
      if (l.upsampleTile(r)) return this.fetchAvailabilityUpsample(r.level, r.row, r.col, r, s);
      throw e;
    });
    return this._fetchAvailabilityUpsamplePrefetch(r.id, e, t, i, s, o), o;
  }
  _fetchAvailabilityUpsamplePrefetch(e, t, i, r, s, o) {
    var _this = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      if (!_this._prefetchingEnabled || null == e) return;
      const a = `prefetch-${e}`;
      if (_this.hasHandles(a)) return;
      const n = new AbortController();
      o.then(() => n.abort(), () => n.abort());
      let c = !1;
      const h = (0,_core_handleUtils_js__WEBPACK_IMPORTED_MODULE_6__.makeHandle)(() => {
        c || (c = !0, n.abort());
      });
      if (_this.addHandles(h, a), yield (0,_core_scheduling_js__WEBPACK_IMPORTED_MODULE_11__.waitTicks)(10, n.signal).catch(() => {}), c || (c = !0, _this.removeHandles(a)), (0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_9__.isAborted)(n)) return;
      const m = new _TileKey_js__WEBPACK_IMPORTED_MODULE_18__.TileKey(e, t, i, r),
        f = {
          ...s,
          signal: n.signal
        },
        v = _this.layer.tileInfo;
      for (let l = 0; w._prefetches.length < w._maxPrefetch && v.upsampleTile(m); ++l) {
        const e = _this.fetchAvailability(m.level, m.row, m.col, f);
        w._prefetches.push(e);
        const t = () => {
          w._prefetches.removeUnordered(e);
        };
        e.then(t, t);
      }
    })();
  }
  _initializeTilemapDefinition() {
    if (!this.layer.parsedUrl) return;
    const {
      parsedUrl: e,
      apiKey: t,
      customParameters: i
    } = this.layer;
    this._tilemapCache.clear(), this._tmpTilemapDefinition = {
      service: {
        url: e.path,
        query: (0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_12__.objectToQuery)({
          ...e.query,
          ...i,
          token: t ?? e.query?.token
        }),
        tileServers: this.layer.tileServers,
        request: this.request
      },
      width: this.size,
      height: this.size,
      level: 0,
      row: 0,
      col: 0
    };
  }
  _tilemapFromCache(e, t, i, r) {
    r.level = e, r.row = t - t % this.size, r.col = i - i % this.size;
    const s = (0,_Tilemap_js__WEBPACK_IMPORTED_MODULE_19__.tilemapDefinitionId)(r);
    return this._tilemapCache.get(s);
  }
  get test() {
    const e = this;
    return {
      get prefetchingEnabled() {
        return e._prefetchingEnabled;
      },
      set prefetchingEnabled(t) {
        e._prefetchingEnabled = t;
      },
      hasTilemap: (t, i, r) => !!e._tilemapFromCache(t, i, r, e._tmpTilemapDefinition)
    };
  }
};
T._maxPrefetch = 4, T._prefetches = new _core_PooledArray_js__WEBPACK_IMPORTED_MODULE_8__["default"]({
  initialSize: w._maxPrefetch
}), (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_13__.property)({
  constructOnly: !0
})], T.prototype, "layer", void 0), (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_13__.property)({
  constructOnly: !0
})], T.prototype, "minLOD", void 0), (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_13__.property)({
  constructOnly: !0
})], T.prototype, "maxLOD", void 0), (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_13__.property)({
  constructOnly: !0
})], T.prototype, "request", void 0), (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_13__.property)({
  constructOnly: !0
})], T.prototype, "size", void 0), T = w = (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_17__.subclass)("esri.layers.support.TilemapCache")], T);


/***/ })

}]);
//# sourceMappingURL=default-node_modules_arcgis_core_layers_support_TilemapCache_js.js.map