{"version":3,"file":"node_modules_arcgis_core_views_2d_layers_features_support_FeatureFilter_js.js","mappings":"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","sources":["./node_modules/@arcgis/core/views/2d/layers/features/support/FeatureFilter.js","./node_modules/@arcgis/core/views/2d/layers/features/support/whereUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/Error.js\";import e from\"../../../../../core/Logger.js\";import{create as i}from\"../../../../../geometry/support/aaBoundingRect.js\";import{getBoundsXY as s}from\"../../../../../geometry/support/boundsUtils.js\";import{normalizeQueryLike as r}from\"../../../../../layers/graphics/data/queryUtils.js\";import{getSpatialQueryOperator as o}from\"../../../../../layers/graphics/data/spatialQuerySupport.js\";import{getTimeOperator as h}from\"../../../../../layers/graphics/data/timeSupport.js\";import a from\"../../../../../rest/support/Query.js\";import{featureAdapter as l}from\"../FeatureStore2D.js\";import{createWhereClause as n}from\"./whereUtils.js\";const d=1,m=2;class p{constructor(t){this._geometryBounds=i(),this._idToVisibility=new Map,this._serviceInfo=t}get hash(){return this._hash}check(t){return this._applyFilter(t)}clear(){const t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,d)}setTrue(t){const e=[],i=[],s=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const o=!!(this._idToVisibility.get(r)&d),h=s.has(r);!o&&h?e.push(r):o&&!h&&i.push(r),this._idToVisibility.set(r,h?d|m:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r}=this;return a.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await r(t,null,e);await Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t?.where)return this._clause=null,void(this.where=null);this._clause=await n(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t?.objectIds&&new Set(t.objectIds),this._idsToHide=t?.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t?.objectIds}async _setGeometryFilter(t){if(!t?.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel||\"esriSpatialRelIntersects\",r=await o(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);s(this._geometryBounds,e),this._spatialQueryOperator=r,this.geometry=e,this.spatialRel=i}_setTimeFilter(i){if(this.timeExtent=this._timeOperator=null,i?.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=i.timeExtent,this._timeOperator=h(this._serviceInfo.timeInfo,i.timeExtent,l);else{const s=new t(\"feature-layer-view:time-filter-not-available\",\"Unable to apply time filter, as layer doesn't have time metadata.\",i.timeExtent);e.getLogger(\"esri.views.2d.layers.features.controllers.FeatureFilter\").error(s)}}_applyFilter(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)}_filterByExpression(t){return!this.where||this._clause(t)}_filterById(t){return(!this._idsToHide?.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readHydratedGeometry();return!!e&&this._spatialQueryOperator(e)}_filterByTime(t){return null==this._timeOperator||this._timeOperator(t)}_resetAllHiddenIds(){const t=[];return this._idToVisibility.forEach(((e,i)=>{e&d||(this._idToVisibility.set(i,d),t.push(i))})),t}}export{p as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Error.js\";import r from\"../../../../../core/Logger.js\";import{parseWhereClause as t}from\"../../../../../core/sql.js\";const a=r.getLogger(\"esri.views.2d.layers.features.support.whereUtils\"),o={getAttribute:(e,r)=>e.readAttribute(r)};async function s(r,s){try{const n=await t(r,s);if(!n.isStandardized){const r=new e(\"mapview - bad input\",\"Unable to apply filter's definition expression, as expression is not standardized.\",n);a.error(r)}return e=>{const r=e.readArcadeFeature();return n.testFeature(r,o)}}catch(n){return a.warn(\"mapview-bad-where-clause\",\"Encountered an error when evaluating where clause\",r),e=>!0}}export{s as createWhereClause};\n"],"names":["t","e","create","i","getBoundsXY","s","normalizeQueryLike","r","getSpatialQueryOperator","o","getTimeOperator","h","a","featureAdapter","l","createWhereClause","n","d","m","p","constructor","_geometryBounds","_idToVisibility","Map","_serviceInfo","hash","_hash","check","_applyFilter","clear","_resetAllHiddenIds","update","show","hide","invalidate","forEach","set","setKnownIds","setTrue","Set","get","has","push","createQuery","geometry","spatialRel","where","timeExtent","objectIds","fromJSON","JSON","stringify","Promise","all","_setGeometryFilter","_setIdFilter","_setAttributeFilter","_setTimeFilter","_clause","fieldsIndex","_idsToShow","_idsToHide","hiddenIds","_spatialQueryOperator","geometryType","hasZ","hasM","_timeOperator","timeInfo","getLogger","error","_filterByGeometry","_filterById","_filterByTime","_filterByExpression","size","getObjectId","readHydratedGeometry","default","parseWhereClause","getAttribute","readAttribute","isStandardized","readArcadeFeature","testFeature","warn"],"sourceRoot":"webpack:///","x_google_ignoreList":[0,1]}