{"version":3,"file":"node_modules_arcgis_core_layers_graphics_sources_WFSSourceWorker_js.js","mappings":"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","sources":["./node_modules/@arcgis/core/layers/graphics/sources/WFSSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"../../../core/asyncUtils.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{throwIfAborted as s,isAbortError as a}from\"../../../core/promiseUtils.js\";import{equals as i}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as o,convertToGeometry as n}from\"../featureConversionUtils.js\";import u from\"../data/FeatureStore.js\";import{checkProjectionSupport as p,project as l}from\"../data/projectionSupport.js\";import{QueryEngine as h}from\"../data/QueryEngine.js\";import{validateGeoJSON as c,createOptimizedFeatures as m}from\"./geojson/geojson.js\";import{mixAttributes as y}from\"./support/sourceUtils.js\";import{getGetFeatureSpatialReference as f,getFeature as g}from\"../../ogc/wfsUtils.js\";import d from\"../../support/FieldsIndex.js\";import{utc as _}from\"../../../time/timeZoneUtils.js\";class F{constructor(){this._queryEngine=null,this._customParameters=null}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,r){const{getFeatureUrl:a,getFeatureOutputFormat:i,fields:o,geometryType:n,featureType:l,objectIdField:c,customParameters:m}=e,{spatialReference:y,getFeatureSpatialReference:g}=f(a,l,e.spatialReference);this._featureType=l,this._customParameters=m,this._getFeatureUrl=a,this._getFeatureOutputFormat=i,this._getFeatureSpatialReference=g;try{await p(g,y)}catch{throw new t(\"unsupported-projection\",\"Projection not supported\",{inSpatialReference:g,outSpatialReference:y})}s(r);const F=d.fromLayerJSON({fields:o,dateFieldsTimeReference:o.some((e=>\"esriFieldTypeDate\"===e.type))?{timeZoneIANA:_}:null}),w=await this._snapshotFeatures({fieldsIndex:F,geometryType:n,objectIdField:c,spatialReference:y},r.signal);return this._queryEngine=new h({fieldsIndex:F,geometryType:n,hasM:!1,hasZ:!1,objectIdField:c,spatialReference:y,timeInfo:null,featureStore:new u({geometryType:n,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(w),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new t(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(s){return this._customParameters=s,this._snapshotTask?.abort(),this._snapshotTask=e((e=>this._snapshotFeatures(this._queryEngine,e))),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(e=>{this._queryEngine.featureStore.clear(),a(e)||r.getLogger(\"esri.layers.WFSLayer\").error(new t(\"wfs-layer:getfeature-error\",\"An error occurred during the GetFeature request\",{error:e}))})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _snapshotFeatures({objectIdField:e,geometryType:t,spatialReference:r,fieldsIndex:a},u){const p=await g(this._getFeatureUrl??\"\",this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,signal:u});c(p,this._getFeatureSpatialReference.wkid),s(u);const h=m(p,{geometryType:t,hasZ:!1,objectIdField:e});if(!i(r,this._getFeatureSpatialReference))for(const s of h)null!=s.geometry&&(s.geometry=o(l(n(s.geometry,t,!1,!1),this._getFeatureSpatialReference,r)));let f=1;for(const s of h){const t={};y(a,t,s.attributes,!0),s.attributes=t,null==t[e]&&(s.objectId=t[e]=f++)}return h}}export{F as default};\n"],"names":["createTask","e","t","r","throwIfAborted","s","isAbortError","a","equals","i","convertFromGeometry","o","convertToGeometry","n","u","checkProjectionSupport","p","project","l","QueryEngine","h","validateGeoJSON","c","createOptimizedFeatures","m","mixAttributes","y","getGetFeatureSpatialReference","f","getFeature","g","d","utc","_","F","constructor","_queryEngine","_customParameters","destroy","load","getFeatureUrl","getFeatureOutputFormat","fields","geometryType","featureType","objectIdField","customParameters","spatialReference","getFeatureSpatialReference","_featureType","_getFeatureUrl","_getFeatureOutputFormat","_getFeatureSpatialReference","inSpatialReference","outSpatialReference","fromLayerJSON","dateFieldsTimeReference","some","type","timeZoneIANA","w","_snapshotFeatures","fieldsIndex","signal","hasM","hasZ","timeInfo","featureStore","addMany","extent","fetchRecomputedExtents","fullExtent","applyEdits","queryFeatures","_waitSnapshotComplete","executeQuery","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","queryExtent","executeQueryForExtent","querySnapping","executeQueryForSnapping","refresh","_snapshotTask","abort","promise","then","clear","getLogger","error","finished","typeName","wkid","geometry","attributes","objectId","default"],"sourceRoot":"webpack:///","x_google_ignoreList":[0]}