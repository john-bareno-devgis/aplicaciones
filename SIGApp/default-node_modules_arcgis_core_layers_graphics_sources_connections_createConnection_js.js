"use strict";
(self["webpackChunkrealgis"] = self["webpackChunkrealgis"] || []).push([["default-node_modules_arcgis_core_layers_graphics_sources_connections_createConnection_js"],{

/***/ 40074:
/*!*********************************************************************************************!*\
  !*** ./node_modules/@arcgis/core/layers/graphics/sources/connections/GeoEventConnection.js ***!
  \*********************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ y)
/* harmony export */ });
/* harmony import */ var _home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 71670);
/* harmony import */ var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../chunks/tslib.es6.js */ 18100);
/* harmony import */ var _geometry_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../geometry.js */ 6010);
/* harmony import */ var _request_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../request.js */ 1897);
/* harmony import */ var _core_Error_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../core/Error.js */ 32995);
/* harmony import */ var _core_Logger_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../core/Logger.js */ 28191);
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../core/promiseUtils.js */ 30801);
/* harmony import */ var _core_urlUtils_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../core/urlUtils.js */ 55050);
/* harmony import */ var _core_accessorSupport_ensureType_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../core/accessorSupport/ensureType.js */ 83382);
/* harmony import */ var _core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../core/arrayUtils.js */ 19420);
/* harmony import */ var _core_has_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../core/has.js */ 67087);
/* harmony import */ var _core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../core/accessorSupport/decorators/subclass.js */ 20891);
/* harmony import */ var _WebSocketConnection_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./WebSocketConnection.js */ 72243);
/* harmony import */ var _rest_query_operations_query_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../rest/query/operations/query.js */ 78170);
/* harmony import */ var _rest_support_Query_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../rest/support/Query.js */ 28665);
/* harmony import */ var _geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../../geometry/support/jsonUtils.js */ 71182);
/* harmony import */ var _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../../geometry/SpatialReference.js */ 68230);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
















const h = 1e4,
  d = {
    maxQueryDepth: 5,
    maxRecordCountFactor: 3
  };
let g = class extends _WebSocketConnection_js__WEBPACK_IMPORTED_MODULE_12__.WebSocketConnection {
  constructor(e) {
    super({
      ...d,
      ...e
    }), this._buddyServicesQuery = null, this._relatedFeatures = null;
  }
  _open() {
    var _this = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      const e = yield _this._fetchServiceDefinition(_this._config.source);
      e.timeInfo.trackIdField || _core_Logger_js__WEBPACK_IMPORTED_MODULE_5__["default"].getLogger(_this).warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.");
      const t = _this._fetchWebSocketUrl(e.streamUrls, _this._config.spatialReference);
      _this._buddyServicesQuery || (_this._buddyServicesQuery = _this._queryBuddyServices()), yield _this._buddyServicesQuery, yield _this._tryCreateWebSocket(t);
      const {
        filter: r,
        outFields: o
      } = _this._config;
      _this.destroyed || _this._setFilter(r, o);
    })();
  }
  _onMessage(e) {
    if ("attributes" in e) {
      let o;
      try {
        o = this._enrich(e), null != this._featureZScaler && this._featureZScaler(o.geometry);
      } catch (t) {
        return void _core_Logger_js__WEBPACK_IMPORTED_MODULE_5__["default"].getLogger(this).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_4__["default"]("geoevent-connection", "Failed to parse message", t));
      }
      this.onFeature(o);
    } else this.onMessage(e);
  }
  _fetchServiceDefinition(e) {
    var _this2 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      const r = {
          f: "json",
          ..._this2._config.customParameters
        },
        s = (0,_request_js__WEBPACK_IMPORTED_MODULE_3__["default"])(e.path, {
          query: r,
          responseType: "json"
        }),
        o = (yield s).data;
      return _this2._serviceDefinition = o, o;
    })();
  }
  _fetchWebSocketUrl(e, t) {
    const r = e[0],
      {
        urls: s,
        token: o
      } = r,
      n = this._inferWebSocketBaseUrl(s);
    return (0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_7__.addQueryParameters)(`${n}/subscribe`, {
      outSR: "" + t.wkid,
      token: o
    });
  }
  _inferWebSocketBaseUrl(e) {
    if (1 === e.length) return e[0];
    for (const t of e) if (t.includes("wss")) return t;
    return _core_Logger_js__WEBPACK_IMPORTED_MODULE_5__["default"].getLogger(this).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_4__["default"]("geoevent-connection", "Unable to infer WebSocket url", e)), null;
  }
  _setFilter(e, t) {
    var _this3 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      const i = _this3._websocket;
      if (null == i || null == e && null == t) return;
      const n = JSON.stringify({
        filter: _this3._serializeFilter(e, t)
      });
      let a = !1;
      const c = (0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_6__.createResolver)(),
        u = () => {
          a || (_this3.destroyed || _this3._websocket !== i || _core_Logger_js__WEBPACK_IMPORTED_MODULE_5__["default"].getLogger(_this3).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_4__["default"]("geoevent-connection", "Server timed out when setting filter")), c.reject());
        },
        l = e => {
          const t = JSON.parse(e.data);
          t.filter && (t.error && (_core_Logger_js__WEBPACK_IMPORTED_MODULE_5__["default"].getLogger(_this3).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_4__["default"]("geoevent-connection", "Failed to set service filter", t.error)), _this3._set("errorString", `Could not set service filter - ${t.error}`), c.reject(t.error)), _this3._setWebSocketJSONParseHandler(i), a = !0, c.resolve());
        };
      return i.onmessage = l, i.send(n), setTimeout(u, h), c.promise;
    })();
  }
  _serializeFilter(e, t) {
    const o = {};
    if (null == e && null == t) return o;
    if (e?.geometry) try {
      const t = (0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_15__.fromJSON)(e.geometry);
      if ("extent" !== t.type) throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_4__["default"](`Expected extent but found type ${t.type}`);
      o.geometry = JSON.stringify(t.shiftCentralMeridian());
    } catch (i) {
      _core_Logger_js__WEBPACK_IMPORTED_MODULE_5__["default"].getLogger(this).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_4__["default"]("geoevent-connection", "Encountered an error when setting connection geometryDefinition", i));
    }
    return e?.where && "1 = 1" !== e.where && "1=1" !== e.where && (o.where = e.where), null != t && (o.outFields = t.join(",")), o;
  }
  _enrich(e) {
    if (!this._relatedFeatures) return e;
    const t = this._serviceDefinition.relatedFeatures.joinField,
      o = e.attributes[t],
      i = this._relatedFeatures.get(o);
    if (!i) return _core_Logger_js__WEBPACK_IMPORTED_MODULE_5__["default"].getLogger(this).warn("geoevent-connection", "Feature join failed. Is the join field configured correctly?", e), e;
    const {
      attributes: n,
      geometry: a
    } = i;
    for (const r in n) e.attributes[r] = n[r];
    return a && (e.geometry = a), e.geometry || e.centroid || _core_Logger_js__WEBPACK_IMPORTED_MODULE_5__["default"].getLogger(this).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_4__["default"]("geoevent-connection", "Found malformed feature - no geometry found", e)), e;
  }
  _queryBuddyServices() {
    var _this4 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      try {
        const {
            relatedFeatures: e,
            keepLatestArchive: t
          } = _this4._serviceDefinition,
          r = _this4._queryRelatedFeatures(e),
          s = _this4._queryArchive(t);
        yield r;
        const o = yield s;
        if (!o) return;
        for (const i of o.features) _this4.onFeature(_this4._enrich(i));
      } catch (e) {
        _core_Logger_js__WEBPACK_IMPORTED_MODULE_5__["default"].getLogger(_this4).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_4__["default"]("geoevent-connection", "Encountered an error when querying buddy services", {
          error: e
        }));
      }
    })();
  }
  _queryRelatedFeatures(e) {
    var _this5 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      if (!e) return;
      const t = yield _this5._queryBuddy(e.featuresUrl);
      _this5._addRelatedFeatures(t);
    })();
  }
  _queryArchive(e) {
    var _this6 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      if (e) return _this6._queryBuddy(e.featuresUrl);
    })();
  }
  _queryBuddy(e) {
    var _this7 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      const t = new (yield Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../../../FeatureLayer.js */ 88749))).default({
          url: e
        }),
        {
          capabilities: r
        } = yield t.load(),
        s = r.query.supportsMaxRecordCountFactor,
        o = r.query.supportsPagination,
        i = r.query.supportsCentroid,
        n = _this7._config.maxRecordCountFactor,
        a = t.capabilities.query.maxRecordCount,
        l = s ? a * n : a,
        h = new _rest_support_Query_js__WEBPACK_IMPORTED_MODULE_14__["default"]();
      if (h.outFields = _this7._config.outFields ?? ["*"], h.where = _this7._config.filter?.where ?? "1=1", h.returnGeometry = !0, h.returnExceededLimitFeatures = !0, h.outSpatialReference = _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_16__["default"].fromJSON(_this7._config.spatialReference), i && (h.returnCentroid = !0), s && (h.maxRecordCountFactor = n), o) return h.num = l, t.destroy(), _this7._queryPages(e, h);
      const d = yield (0,_rest_query_operations_query_js__WEBPACK_IMPORTED_MODULE_13__.executeQuery)(e, h, _this7._config.sourceSpatialReference);
      return t.destroy(), d.data;
    })();
  }
  _queryPages(e, t, r = [], s = 0) {
    var _this8 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      t.start = null != t.num ? s * t.num : null;
      const {
        data: o
      } = yield (0,_rest_query_operations_query_js__WEBPACK_IMPORTED_MODULE_13__.executeQuery)(e, t, _this8._config.sourceSpatialReference);
      return o.exceededTransferLimit && s < (_this8._config.maxQueryDepth ?? 0) ? (o.features.forEach(e => r.push(e)), _this8._queryPages(e, t, r, s + 1)) : (r.forEach(e => o.features.push(e)), o);
    })();
  }
  _addRelatedFeatures(e) {
    const t = new Map(),
      r = e.features,
      s = this._serviceDefinition.relatedFeatures.joinField;
    for (const o of r) {
      const e = o.attributes[s];
      t.set(e, o);
    }
    this._relatedFeatures = t;
  }
};
g = (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_11__.subclass)("esri.layers.graphics.sources.connections.GeoEventConnection")], g);
const y = g;


/***/ }),

/***/ 72243:
/*!**********************************************************************************************!*\
  !*** ./node_modules/@arcgis/core/layers/graphics/sources/connections/WebSocketConnection.js ***!
  \**********************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "WebSocketConnection": () => (/* binding */ d)
/* harmony export */ });
/* harmony import */ var _home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 71670);
/* harmony import */ var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../chunks/tslib.es6.js */ 18100);
/* harmony import */ var _core_Error_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../core/Error.js */ 32995);
/* harmony import */ var _core_Logger_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../core/Logger.js */ 28191);
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../core/promiseUtils.js */ 30801);
/* harmony import */ var _core_urlUtils_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../core/urlUtils.js */ 55050);
/* harmony import */ var _core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../core/accessorSupport/decorators/property.js */ 9497);
/* harmony import */ var _core_accessorSupport_ensureType_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../core/accessorSupport/ensureType.js */ 83382);
/* harmony import */ var _core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../core/arrayUtils.js */ 19420);
/* harmony import */ var _core_has_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../core/has.js */ 67087);
/* harmony import */ var _core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../core/accessorSupport/decorators/subclass.js */ 20891);
/* harmony import */ var _geometry_support_zscale_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../geometry/support/zscale.js */ 83970);
/* harmony import */ var _support_StreamConnection_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../support/StreamConnection.js */ 79947);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/












var h;
!function (e) {
  e[e.CONNECTING = 0] = "CONNECTING", e[e.OPEN = 1] = "OPEN", e[e.CLOSING = 2] = "CLOSING", e[e.CLOSED = 3] = "CLOSED";
}(h || (h = {}));
let d = class extends _support_StreamConnection_js__WEBPACK_IMPORTED_MODULE_12__["default"] {
  constructor(e) {
    super(), this._outstandingMessages = [], this.errorString = null;
    const {
      geometryType: t,
      spatialReference: o,
      sourceSpatialReference: s
    } = e;
    this._config = e, this._featureZScaler = (0,_geometry_support_zscale_js__WEBPACK_IMPORTED_MODULE_11__.getGeometryZScaler)(t, s, o), this._open();
  }
  _open() {
    var _this = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      yield _this._tryCreateWebSocket(), _this.destroyed || (yield _this._handshake());
    })();
  }
  destroy() {
    super.destroy(), null != this._websocket && (this._websocket.onopen = null, this._websocket.onclose = null, this._websocket.onerror = null, this._websocket.onmessage = null, this._websocket.close()), this._websocket = null;
  }
  get connectionStatus() {
    if (null == this._websocket) return "disconnected";
    switch (this._websocket.readyState) {
      case h.CONNECTING:
      case h.OPEN:
        return "connected";
      case h.CLOSING:
      case h.CLOSED:
        return "disconnected";
    }
  }
  sendMessageToSocket(e) {
    null != this._websocket ? this._websocket.send(JSON.stringify(e)) : this._outstandingMessages.push(e);
  }
  sendMessageToClient(e) {
    this._onMessage(e);
  }
  updateCustomParameters(e) {
    this._config.customParameters = e, null != this._websocket && this._websocket.close();
  }
  _tryCreateWebSocket(e = this._config.source.path, r = 1e3, i = 0) {
    var _this2 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      try {
        if (_this2.destroyed) return;
        const t = (0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_5__.addQueryParameters)(e, _this2._config.customParameters ?? {});
        _this2._websocket = yield _this2._createWebSocket(t), _this2.notifyChange("connectionStatus");
      } catch (c) {
        const n = r / 1e3;
        return _this2._config.maxReconnectionAttempts && i >= _this2._config.maxReconnectionAttempts ? (_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__["default"].getLogger(_this2).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("websocket-connection", "Exceeded maxReconnectionAttempts attempts. No further attempts will be made")), void _this2.destroy()) : (_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__["default"].getLogger(_this2).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("websocket-connection", `Failed to connect. Attempting to reconnect in ${n}s`, c)), yield (0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_4__.after)(r), _this2._tryCreateWebSocket(e, Math.min(1.5 * r, 1e3 * _this2._config.maxReconnectionInterval), i + 1));
      }
    })();
  }
  _setWebSocketJSONParseHandler(e) {
    e.onmessage = e => {
      try {
        const t = JSON.parse(e.data);
        this._onMessage(t);
      } catch (s) {
        return void _core_Logger_js__WEBPACK_IMPORTED_MODULE_3__["default"].getLogger(this).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("websocket-connection", "Failed to parse message, invalid JSON", {
          error: s
        }));
      }
    };
  }
  _createWebSocket(e) {
    return new Promise((t, o) => {
      const s = new WebSocket(e);
      s.onopen = () => {
        if (s.onopen = null, this.destroyed) return s.onclose = null, void s.close();
        s.onclose = e => this._onClose(e), s.onerror = e => this._onError(e), this._setWebSocketJSONParseHandler(s), t(s);
      }, s.onclose = e => {
        s.onopen = s.onclose = null, o(e);
      };
    });
  }
  _handshake(e = 1e4) {
    var _this3 = this;
    return (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      const s = _this3._websocket;
      if (null == s) return;
      const n = (0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_4__.createResolver)(),
        i = s.onmessage,
        {
          filter: c,
          outFields: a,
          spatialReference: l
        } = _this3._config;
      return n.timeout(e), s.onmessage = e => {
        let r = null;
        try {
          r = JSON.parse(e.data);
        } catch (h) {}
        r && "object" == typeof r || (_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__["default"].getLogger(_this3).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("websocket-connection", "Protocol violation. Handshake failed - malformed message", e.data)), n.reject(), _this3.destroy()), r.spatialReference?.wkid !== l?.wkid && (_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__["default"].getLogger(_this3).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("websocket-connection", `Protocol violation. Handshake failed - expected wkid of ${l.wkid}`, e.data)), n.reject(), _this3.destroy()), "json" !== r.format && (_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__["default"].getLogger(_this3).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("websocket-connection", "Protocol violation. Handshake failed - format is not set", e.data)), n.reject(), _this3.destroy()), c && r.filter !== c && _core_Logger_js__WEBPACK_IMPORTED_MODULE_3__["default"].getLogger(_this3).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("websocket-connection", "Tried to set filter, but server doesn't support it")), a && r.outFields !== a && _core_Logger_js__WEBPACK_IMPORTED_MODULE_3__["default"].getLogger(_this3).error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__["default"]("websocket-connection", "Tried to set outFields, but server doesn't support it")), s.onmessage = i;
        for (const t of _this3._outstandingMessages) s.send(JSON.stringify(t));
        _this3._outstandingMessages = [], n.resolve();
      }, s.send(JSON.stringify({
        filter: c,
        outFields: a,
        format: "json",
        spatialReference: {
          wkid: l.wkid
        }
      })), n.promise;
    })();
  }
  _onMessage(e) {
    if (this.onMessage(e), "type" in e) switch (e.type) {
      case "features":
      case "featureResult":
        for (const t of e.features) null != this._featureZScaler && this._featureZScaler(t.geometry), this.onFeature(t);
    }
  }
  _onError(e) {
    const t = "Encountered an error over WebSocket connection";
    this._set("errorString", t), _core_Logger_js__WEBPACK_IMPORTED_MODULE_3__["default"].getLogger(this).error("websocket-connection", t);
  }
  _onClose(e) {
    this._websocket = null, this.notifyChange("connectionStatus"), 1e3 !== e.code && _core_Logger_js__WEBPACK_IMPORTED_MODULE_3__["default"].getLogger(this).error("websocket-connection", `WebSocket closed unexpectedly with error code ${e.code}`), this.destroyed || this._open();
  }
};
(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_6__.property)()], d.prototype, "connectionStatus", null), (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_6__.property)()], d.prototype, "errorString", void 0), d = (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_1__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_10__.subclass)("esri.layers.graphics.sources.connections.WebSocketConnection")], d);


/***/ }),

/***/ 70890:
/*!*******************************************************************************************!*\
  !*** ./node_modules/@arcgis/core/layers/graphics/sources/connections/createConnection.js ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "createConnection": () => (/* binding */ o)
/* harmony export */ });
/* harmony import */ var _GeoEventConnection_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./GeoEventConnection.js */ 40074);
/* harmony import */ var _WebSocketConnection_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./WebSocketConnection.js */ 72243);
/* harmony import */ var _support_ClientSideConnection_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../support/ClientSideConnection.js */ 31483);
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/



function o(o, r, s, i, c, a, m, p) {
  const f = {
    source: o,
    sourceSpatialReference: r,
    spatialReference: s,
    geometryType: i,
    filter: c,
    maxReconnectionAttempts: a,
    maxReconnectionInterval: m,
    customParameters: p
  };
  if (!o) return new _support_ClientSideConnection_js__WEBPACK_IMPORTED_MODULE_2__.ClientSideConnection(f);
  return o.path.startsWith("wss://") || o.path.startsWith("ws://") ? new _WebSocketConnection_js__WEBPACK_IMPORTED_MODULE_1__.WebSocketConnection(f) : new _GeoEventConnection_js__WEBPACK_IMPORTED_MODULE_0__["default"](f);
}


/***/ }),

/***/ 31483:
/*!**************************************************************************!*\
  !*** ./node_modules/@arcgis/core/layers/support/ClientSideConnection.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "ClientSideConnection": () => (/* binding */ c)
/* harmony export */ });
/* harmony import */ var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../chunks/tslib.es6.js */ 18100);
/* harmony import */ var _core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../core/accessorSupport/decorators/property.js */ 9497);
/* harmony import */ var _core_accessorSupport_ensureType_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../core/accessorSupport/ensureType.js */ 83382);
/* harmony import */ var _core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../core/arrayUtils.js */ 19420);
/* harmony import */ var _core_has_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../core/has.js */ 67087);
/* harmony import */ var _core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../core/accessorSupport/decorators/subclass.js */ 20891);
/* harmony import */ var _geometry_support_zscale_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../geometry/support/zscale.js */ 83970);
/* harmony import */ var _StreamConnection_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./StreamConnection.js */ 79947);
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/








let c = class extends _StreamConnection_js__WEBPACK_IMPORTED_MODULE_7__["default"] {
  constructor(e) {
    super(), this.connectionStatus = "connected", this.errorString = null;
    const {
      geometryType: r,
      spatialReference: t,
      sourceSpatialReference: s
    } = e;
    this._featureZScaler = (0,_geometry_support_zscale_js__WEBPACK_IMPORTED_MODULE_6__.getGeometryZScaler)(r, s, t);
  }
  updateCustomParameters(e) {}
  sendMessageToSocket(e) {}
  sendMessageToClient(e) {
    if ("type" in e) switch (e.type) {
      case "features":
      case "featureResult":
        for (const r of e.features) null != this._featureZScaler && this._featureZScaler(r.geometry), this.onFeature(r);
    }
    this.onMessage(e);
  }
};
(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.property)()], c.prototype, "connectionStatus", void 0), (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.property)()], c.prototype, "errorString", void 0), c = (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_5__.subclass)("esri.layers.support.ClientSideConnection")], c);


/***/ }),

/***/ 79947:
/*!**********************************************************************!*\
  !*** ./node_modules/@arcgis/core/layers/support/StreamConnection.js ***!
  \**********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ i)
/* harmony export */ });
/* harmony import */ var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../chunks/tslib.es6.js */ 18100);
/* harmony import */ var _core_Error_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../core/Error.js */ 32995);
/* harmony import */ var _core_Evented_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../core/Evented.js */ 95442);
/* harmony import */ var _core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../core/accessorSupport/decorators/property.js */ 9497);
/* harmony import */ var _core_accessorSupport_ensureType_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../core/accessorSupport/ensureType.js */ 83382);
/* harmony import */ var _core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../core/arrayUtils.js */ 19420);
/* harmony import */ var _core_has_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../core/has.js */ 67087);
/* harmony import */ var _core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../core/accessorSupport/decorators/subclass.js */ 20891);
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/








let c = class extends _core_Evented_js__WEBPACK_IMPORTED_MODULE_2__["default"].EventedAccessor {
  destroy() {
    this.emit("destroy");
  }
  get connectionError() {
    return this.errorString ? new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__["default"]("stream-connection", this.errorString) : null;
  }
  onFeature(r) {
    this.emit("data-received", r);
  }
  onMessage(r) {
    this.emit("message-received", r);
  }
};
(0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.property)({
  readOnly: !0
})], c.prototype, "connectionError", null), c = (0,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__._)([(0,_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__.subclass)("esri.layers.support.StreamConnection")], c);
const i = c;


/***/ }),

/***/ 58558:
/*!***************************************************************!*\
  !*** ./node_modules/@arcgis/core/rest/operations/urlUtils.js ***!
  \***************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "mapParameters": () => (/* binding */ t)
/* harmony export */ });
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
function t(n) {
  const o = {};
  for (const e in n) {
    if ("declaredClass" === e) continue;
    const r = n[e];
    if (null != r && "function" != typeof r) if (Array.isArray(r)) {
      o[e] = [];
      for (let n = 0; n < r.length; n++) o[e][n] = t(r[n]);
    } else "object" == typeof r ? r.toJSON && (o[e] = JSON.stringify(r)) : o[e] = r;
  }
  return o;
}


/***/ }),

/***/ 78170:
/*!******************************************************************!*\
  !*** ./node_modules/@arcgis/core/rest/query/operations/query.js ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "encodeGeometry": () => (/* binding */ m),
/* harmony export */   "executeQuery": () => (/* binding */ c),
/* harmony export */   "executeQueryForCount": () => (/* binding */ S),
/* harmony export */   "executeQueryForExtent": () => (/* binding */ x),
/* harmony export */   "executeQueryForIds": () => (/* binding */ p),
/* harmony export */   "executeQueryPBF": () => (/* binding */ f),
/* harmony export */   "executeQueryPBFBuffer": () => (/* binding */ d),
/* harmony export */   "queryToQueryStringParameters": () => (/* binding */ y),
/* harmony export */   "runQuery": () => (/* binding */ E)
/* harmony export */ });
/* harmony import */ var _home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 71670);
/* harmony import */ var _request_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../request.js */ 1897);
/* harmony import */ var _core_urlUtils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../core/urlUtils.js */ 55050);
/* harmony import */ var _geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../geometry/support/jsonUtils.js */ 71182);
/* harmony import */ var _geometry_support_normalizeUtils_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../geometry/support/normalizeUtils.js */ 93136);
/* harmony import */ var _geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../geometry/support/spatialReferenceUtils.js */ 53492);
/* harmony import */ var _operations_urlUtils_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../operations/urlUtils.js */ 58558);
/* harmony import */ var _pbfQueryUtils_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./pbfQueryUtils.js */ 49592);
/* harmony import */ var _queryZScale_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./queryZScale.js */ 59937);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/








const s = "Layer does not support extent calculation.";
function m(t, e) {
  if (e && "extent" === t.type) return `${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;
  if (e && "point" === t.type) return `${t.x},${t.y}`;
  const n = t.toJSON();
  return delete n.spatialReference, JSON.stringify(n);
}
function y(t, e) {
  const n = t.geometry,
    i = t.toJSON();
  delete i.compactGeometryEnabled, delete i.defaultSpatialReferenceEnabled;
  const o = i;
  let u, l, s;
  if (null != n && (l = n.spatialReference, s = (0,_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_5__.srToRESTValue)(l), o.geometryType = (0,_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_3__.getJsonType)(n), o.geometry = m(n, t.compactGeometryEnabled), o.inSR = s), i.groupByFieldsForStatistics && (o.groupByFieldsForStatistics = i.groupByFieldsForStatistics.join(",")), i.objectIds && (o.objectIds = i.objectIds.join(",")), i.orderByFields && (o.orderByFields = i.orderByFields.join(",")), !i.outFields || !i.returnDistinctValues && (e?.returnCountOnly || e?.returnExtentOnly || e?.returnIdsOnly) ? delete o.outFields : i.outFields.includes("*") ? o.outFields = "*" : o.outFields = i.outFields.join(","), i.outSR ? (o.outSR = (0,_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_5__.srToRESTValue)(i.outSR), u = t.outSpatialReference) : n && (i.returnGeometry || i.returnCentroid) && (o.outSR = o.inSR, u = l), i.returnGeometry && delete i.returnGeometry, i.outStatistics && (o.outStatistics = JSON.stringify(i.outStatistics)), i.fullText && (o.fullText = JSON.stringify(i.fullText)), i.pixelSize && (o.pixelSize = JSON.stringify(i.pixelSize)), i.quantizationParameters && (t.defaultSpatialReferenceEnabled && null != l && null != t.quantizationParameters?.extent && l.equals(t.quantizationParameters.extent.spatialReference) && delete i.quantizationParameters.extent.spatialReference, o.quantizationParameters = JSON.stringify(i.quantizationParameters)), i.parameterValues && (o.parameterValues = JSON.stringify(i.parameterValues)), i.rangeValues && (o.rangeValues = JSON.stringify(i.rangeValues)), i.dynamicDataSource && (o.layer = JSON.stringify({
    source: i.dynamicDataSource
  }), delete i.dynamicDataSource), i.timeExtent) {
    const t = i.timeExtent,
      {
        start: e,
        end: n
      } = t;
    null == e && null == n || (o.time = e === n ? e : `${e ?? "null"},${n ?? "null"}`), delete i.timeExtent;
  }
  return t.defaultSpatialReferenceEnabled && null != l && null != u && l.equals(u) && (o.defaultSR = o.inSR, delete o.inSR, delete o.outSR), o;
}
function c(_x, _x2, _x3, _x4) {
  return _c.apply(this, arguments);
}
function _c() {
  _c = (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* (t, e, n, r) {
    const i = null != e.timeExtent && e.timeExtent.isEmpty ? {
      data: {
        features: []
      }
    } : yield E(t, e, "json", r);
    return (0,_queryZScale_js__WEBPACK_IMPORTED_MODULE_8__.applyFeatureSetZUnitScaling)(e, n, i.data), i;
  });
  return _c.apply(this, arguments);
}
function f(_x5, _x6, _x7, _x8) {
  return _f.apply(this, arguments);
}
function _f() {
  _f = (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* (t, e, n, r) {
    if (null != e.timeExtent && e.timeExtent.isEmpty) return {
      data: n.createFeatureResult()
    };
    const i = yield d(t, e, r),
      a = i;
    return a.data = (0,_pbfQueryUtils_js__WEBPACK_IMPORTED_MODULE_7__.parsePBFFeatureQuery)(i.data, n), a;
  });
  return _f.apply(this, arguments);
}
function d(t, e, n) {
  return E(t, e, "pbf", n);
}
function p(t, e, n) {
  return null != e.timeExtent && e.timeExtent.isEmpty ? Promise.resolve({
    data: {
      objectIds: []
    }
  }) : E(t, e, "json", n, {
    returnIdsOnly: !0
  });
}
function S(t, e, n) {
  return null != e.timeExtent && e.timeExtent.isEmpty ? Promise.resolve({
    data: {
      count: 0
    }
  }) : E(t, e, "json", n, {
    returnIdsOnly: !0,
    returnCountOnly: !0
  });
}
function x(_x9, _x10, _x11) {
  return _x12.apply(this, arguments);
}
function _x12() {
  _x12 = (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* (t, e, n) {
    if (null != e.timeExtent && e.timeExtent.isEmpty) return {
      data: {
        count: 0,
        extent: null
      }
    };
    const r = yield E(t, e, "json", n, {
        returnExtentOnly: !0,
        returnCountOnly: !0
      }),
      i = r.data;
    if (i.hasOwnProperty("extent")) return r;
    if (i.features) throw new Error(s);
    if (i.hasOwnProperty("count")) throw new Error(s);
    return r;
  });
  return _x12.apply(this, arguments);
}
function E(_x13, _x14, _x15) {
  return _E.apply(this, arguments);
}
function _E() {
  _E = (0,_home_ohnj_Documentos_realG4Life_1_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* (r, a, u, l = {}, s = {}) {
    const m = "string" == typeof r ? (0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_2__.urlToObject)(r) : r,
      c = a.geometry ? [a.geometry] : [],
      f = yield (0,_geometry_support_normalizeUtils_js__WEBPACK_IMPORTED_MODULE_4__.normalizeCentralMeridian)(c, null, {
        signal: l.signal
      }),
      d = f?.[0];
    null != d && ((a = a.clone()).geometry = d);
    const p = (0,_operations_urlUtils_js__WEBPACK_IMPORTED_MODULE_6__.mapParameters)({
      ...m.query,
      f: u,
      ...s,
      ...y(a, s)
    });
    return (0,_request_js__WEBPACK_IMPORTED_MODULE_1__["default"])((0,_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_2__.join)(m.path, g(a, s) ? "query3d" : "query"), {
      ...l,
      responseType: "pbf" === u ? "array-buffer" : "json",
      query: {
        ...p,
        ...l.query
      }
    });
  });
  return _E.apply(this, arguments);
}
function g(t, e) {
  return null != t.formatOf3DObjects && !(e.returnCountOnly || e.returnExtentOnly || e.returnIdsOnly);
}


/***/ })

}]);
//# sourceMappingURL=default-node_modules_arcgis_core_layers_graphics_sources_connections_createConnection_js.js.map